function FastClick(a){"use strict";var b,c=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=a,!a||!a.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(c,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(c,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(c,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(c,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(c,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(c,arguments)},FastClick.notNeeded(a)||(this.deviceIsAndroid&&(a.addEventListener("mouseover",this.onMouse,!0),a.addEventListener("mousedown",this.onMouse,!0),a.addEventListener("mouseup",this.onMouse,!0)),a.addEventListener("click",this.onClick,!0),a.addEventListener("touchstart",this.onTouchStart,!1),a.addEventListener("touchmove",this.onTouchMove,!1),a.addEventListener("touchend",this.onTouchEnd,!1),a.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(a.removeEventListener=function(b,c,d){var e=Node.prototype.removeEventListener;"click"===b?e.call(a,b,c.hijacked||c,d):e.call(a,b,c,d)},a.addEventListener=function(b,c,d){var e=Node.prototype.addEventListener;"click"===b?e.call(a,b,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(a,b,c,d)}),"function"==typeof a.onclick&&(b=a.onclick,a.addEventListener("click",function(a){b(a)},!1),a.onclick=null))}FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===a.type||a.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(a.className)},FastClick.prototype.needsFocus=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},FastClick.prototype.sendClick=function(a,b){"use strict";var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent(this.determineEventType(a),!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},FastClick.prototype.determineEventType=function(a){"use strict";return this.deviceIsAndroid&&"select"===a.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(a){"use strict";var b;this.deviceIsIOS&&a.setSelectionRange&&0!==a.type.indexOf("date")&&"time"!==a.type?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},FastClick.prototype.updateScrollParent=function(a){"use strict";var b,c;if(b=a.fastClickScrollParent,!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(a){"use strict";return a.nodeType===Node.TEXT_NODE?a.parentNode:a},FastClick.prototype.onTouchStart=function(a){"use strict";var b,c,d;if(a.targetTouches.length>1)return!0;if(b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0],this.deviceIsIOS){if(d=window.getSelection(),d.rangeCount&&!d.isCollapsed)return!0;if(!this.deviceIsIOS4){if(c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<200&&a.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(a){"use strict";var b=a.changedTouches[0],c=this.touchBoundary;return Math.abs(b.pageX-this.touchStartX)>c||Math.abs(b.pageY-this.touchStartY)>c?!0:!1},FastClick.prototype.onTouchMove=function(a){"use strict";return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},FastClick.prototype.findControl=function(a){"use strict";return void 0!==a.control?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(a){"use strict";var b,c,d,e,f,g=this.targetElement;if(!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=a.timeStamp,c=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(f=a.changedTouches[0],g=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||g,g.fastClickScrollParent=this.targetElement.fastClickScrollParent),d=g.tagName.toLowerCase(),"label"===d){if(b=this.findControl(g)){if(this.focus(g),this.deviceIsAndroid)return!1;g=b}}else if(this.needsFocus(g))return a.timeStamp-c>100||this.deviceIsIOS&&window.top!==window&&"input"===d?(this.targetElement=null,!1):(this.focus(g),this.deviceIsIOS4&&"select"===d||(this.targetElement=null,a.preventDefault()),!1);return this.deviceIsIOS&&!this.deviceIsIOS4&&(e=g.fastClickScrollParent,e&&e.fastClickLastScrollTop!==e.scrollTop)?!0:(this.needsClick(g)||(a.preventDefault(),this.sendClick(g,a)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(a){"use strict";return this.targetElement?a.forwardedTouchEvent?!0:a.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0,a.stopPropagation(),a.preventDefault(),!1):!0:!0:!0},FastClick.prototype.onClick=function(a){"use strict";var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===a.target.type&&0===a.detail?!0:(b=this.onMouse(a),b||(this.targetElement=null),b)},FastClick.prototype.destroy=function(){"use strict";var a=this.layer;this.deviceIsAndroid&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchmove",this.onTouchMove,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(a){"use strict";var b;if("undefined"==typeof window.ontouchstart)return!0;if(/Chrome\/[0-9]+/.test(navigator.userAgent)){if(!FastClick.prototype.deviceIsAndroid)return!0;if(b=document.querySelector("meta[name=viewport]"),b&&-1!==b.content.indexOf("user-scalable=no"))return!0}return"none"===a.style.msTouchAction?!0:!1},FastClick.attach=function(a){"use strict";return new FastClick(a)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(void 0===this||null===this)throw new TypeError;var c,d=Object(this),e=d.length>>>0,f=0;if("function"!=typeof b)throw new TypeError;if(0==e&&1==arguments.length)throw new TypeError;if(arguments.length>=2)c=arguments[1];else for(;;){if(f in d){c=d[f++];break}if(++f>=e)throw new TypeError}for(;e>f;)f in d&&(c=b.call(a,c,d[f],f,d)),f++;return c})}();var Zepto=function(){function a(a){return null==a?String(a):W[X.call(a)]||"object"}function b(b){return"function"==a(b)}function c(a){return null!=a&&a==a.window}function d(a){return null!=a&&a.nodeType==a.DOCUMENT_NODE}function e(b){return"object"==a(b)}function f(a){return e(a)&&!c(a)&&a.__proto__==Object.prototype}function g(a){return a instanceof Array}function h(a){return"number"==typeof a.length}function i(a){return E.call(a,function(a){return null!=a})}function j(a){return a.length>0?y.fn.concat.apply([],a):a}function k(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function l(a){return a in H?H[a]:H[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function m(a,b){return"number"!=typeof b||J[k(a)]?b:b+"px"}function n(a){var b,c;return G[a]||(b=F.createElement(a),F.body.appendChild(b),c=I(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),"none"==c&&(c="block"),G[a]=c),G[a]}function o(a){return"children"in a?D.call(a.children):y.map(a.childNodes,function(a){return 1==a.nodeType?a:void 0})}function p(a,b,c){for(x in b)c&&(f(b[x])||g(b[x]))?(f(b[x])&&!f(a[x])&&(a[x]={}),g(b[x])&&!g(a[x])&&(a[x]=[]),p(a[x],b[x],c)):b[x]!==w&&(a[x]=b[x])}function q(a,b){return b===w?y(a):y(a).filter(b)}function r(a,c,d,e){return b(c)?c.call(a,d,e):c}function s(a,b,c){null==c?a.removeAttribute(b):a.setAttribute(b,c)}function t(a,b){var c=a.className,d=c&&c.baseVal!==w;return b===w?d?c.baseVal:c:(d?c.baseVal=b:a.className=b,void 0)}function u(a){var b;try{return a?"true"==a||("false"==a?!1:"null"==a?null:isNaN(b=Number(a))?/^[\[\{]/.test(a)?y.parseJSON(a):a:b):a}catch(c){return a}}function v(a,b){b(a);for(var c in a.childNodes)v(a.childNodes[c],b)}var w,x,y,z,A,B,C=[],D=C.slice,E=C.filter,F=window.document,G={},H={},I=F.defaultView.getComputedStyle,J={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},K=/^\s*<(\w+|!)[^>]*>/,L=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,M=/^(?:body|html)$/i,N=["val","css","html","text","data","width","height","offset"],O=["after","prepend","before","append"],P=F.createElement("table"),Q=F.createElement("tr"),R={tr:F.createElement("tbody"),tbody:P,thead:P,tfoot:P,td:Q,th:Q,"*":F.createElement("div")},S=/complete|loaded|interactive/,T=/^\.([\w-]+)$/,U=/^#([\w-]*)$/,V=/^[\w-]+$/,W={},X=W.toString,Y={},Z=F.createElement("div");return Y.matches=function(a,b){if(!a||1!==a.nodeType)return!1;var c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector;if(c)return c.call(a,b);var d,e=a.parentNode,f=!e;return f&&(e=Z).appendChild(a),d=~Y.qsa(e,b).indexOf(a),f&&Z.removeChild(a),d},A=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},B=function(a){return E.call(a,function(b,c){return a.indexOf(b)==c})},Y.fragment=function(a,b,c){a.replace&&(a=a.replace(L,"<$1></$2>")),b===w&&(b=K.test(a)&&RegExp.$1),b in R||(b="*");var d,e,g=R[b];return g.innerHTML=""+a,e=y.each(D.call(g.childNodes),function(){g.removeChild(this)}),f(c)&&(d=y(e),y.each(c,function(a,b){N.indexOf(a)>-1?d[a](b):d.attr(a,b)})),e},Y.Z=function(a,b){return a=a||[],a.__proto__=y.fn,a.selector=b||"",a},Y.isZ=function(a){return a instanceof Y.Z},Y.init=function(a,c){if(!a)return Y.Z();if(b(a))return y(F).ready(a);if(Y.isZ(a))return a;var d;if(g(a))d=i(a);else if(e(a))d=[f(a)?y.extend({},a):a],a=null;else if(K.test(a))d=Y.fragment(a.trim(),RegExp.$1,c),a=null;else{if(c!==w)return y(c).find(a);d=Y.qsa(F,a)}return Y.Z(d,a)},y=function(a,b){return Y.init(a,b)},y.extend=function(a){var b,c=D.call(arguments,1);return"boolean"==typeof a&&(b=a,a=c.shift()),c.forEach(function(c){p(a,c,b)}),a},Y.qsa=function(a,b){var c;return d(a)&&U.test(b)?(c=a.getElementById(RegExp.$1))?[c]:[]:1!==a.nodeType&&9!==a.nodeType?[]:D.call(T.test(b)?a.getElementsByClassName(RegExp.$1):V.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},y.contains=function(a,b){return a!==b&&a.contains(b)},y.type=a,y.isFunction=b,y.isWindow=c,y.isArray=g,y.isPlainObject=f,y.isEmptyObject=function(a){var b;for(b in a)return!1;return!0},y.inArray=function(a,b,c){return C.indexOf.call(b,a,c)},y.camelCase=A,y.trim=function(a){return a.trim()},y.uuid=0,y.support={},y.expr={},y.map=function(a,b){var c,d,e,f=[];if(h(a))for(d=0;d<a.length;d++)c=b(a[d],d),null!=c&&f.push(c);else for(e in a)c=b(a[e],e),null!=c&&f.push(c);return j(f)},y.each=function(a,b){var c,d;if(h(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},y.grep=function(a,b){return E.call(a,b)},window.JSON&&(y.parseJSON=JSON.parse),y.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){W["[object "+b+"]"]=b.toLowerCase()}),y.fn={forEach:C.forEach,reduce:C.reduce,push:C.push,sort:C.sort,indexOf:C.indexOf,concat:C.concat,map:function(a){return y(y.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return y(D.apply(this,arguments))},ready:function(a){return S.test(F.readyState)?a(y):F.addEventListener("DOMContentLoaded",function(){a(y)},!1),this},get:function(a){return a===w?D.call(this):this[a>=0?a:a+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(a){return C.every.call(this,function(b,c){return a.call(b,c,b)!==!1}),this},filter:function(a){return b(a)?this.not(this.not(a)):y(E.call(this,function(b){return Y.matches(b,a)}))},add:function(a,b){return y(B(this.concat(y(a,b))))},is:function(a){return this.length>0&&Y.matches(this[0],a)},not:function(a){var c=[];if(b(a)&&a.call!==w)this.each(function(b){a.call(this,b)||c.push(this)});else{var d="string"==typeof a?this.filter(a):h(a)&&b(a.item)?D.call(a):y(a);this.forEach(function(a){d.indexOf(a)<0&&c.push(a)})}return y(c)},has:function(a){return this.filter(function(){return e(a)?y.contains(this,a):y(this).find(a).size()})},eq:function(a){return-1===a?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!e(a)?a:y(a)},last:function(){var a=this[this.length-1];return a&&!e(a)?a:y(a)},find:function(a){var b,c=this;return b="object"==typeof a?y(a).filter(function(){var a=this;return C.some.call(c,function(b){return y.contains(b,a)})}):1==this.length?y(Y.qsa(this[0],a)):this.map(function(){return Y.qsa(this,a)})},closest:function(a,b){var c=this[0],e=!1;for("object"==typeof a&&(e=y(a));c&&!(e?e.indexOf(c)>=0:Y.matches(c,a));)c=c!==b&&!d(c)&&c.parentNode;return y(c)},parents:function(a){for(var b=[],c=this;c.length>0;)c=y.map(c,function(a){return(a=a.parentNode)&&!d(a)&&b.indexOf(a)<0?(b.push(a),a):void 0});return q(b,a)},parent:function(a){return q(B(this.pluck("parentNode")),a)},children:function(a){return q(this.map(function(){return o(this)}),a)},contents:function(){return this.map(function(){return D.call(this.childNodes)})},siblings:function(a){return q(this.map(function(a,b){return E.call(o(b.parentNode),function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return y.map(this,function(b){return b[a]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=null),"none"==I(this,"").getPropertyValue("display")&&(this.style.display=n(this.nodeName))})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){var c=b(a);if(this[0]&&!c)var d=y(a).get(0),e=d.parentNode||this.length>1;return this.each(function(b){y(this).wrapAll(c?a.call(this,b):e?d.cloneNode(!0):d)})},wrapAll:function(a){if(this[0]){y(this[0]).before(a=y(a));for(var b;(b=a.children()).length;)a=b.first();y(a).append(this)}return this},wrapInner:function(a){var c=b(a);return this.each(function(b){var d=y(this),e=d.contents(),f=c?a.call(this,b):a;e.length?e.wrapAll(f):d.append(f)})},unwrap:function(){return this.parent().each(function(){y(this).replaceWith(y(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(a){return this.each(function(){var b=y(this);(a===w?"none"==b.css("display"):a)?b.show():b.hide()})},prev:function(a){return y(this.pluck("previousElementSibling")).filter(a||"*")},next:function(a){return y(this.pluck("nextElementSibling")).filter(a||"*")},html:function(a){return a===w?this.length>0?this[0].innerHTML:null:this.each(function(b){var c=this.innerHTML;y(this).empty().append(r(this,a,b,c))})},text:function(a){return a===w?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=a})},attr:function(a,b){var c;return"string"==typeof a&&b===w?0==this.length||1!==this[0].nodeType?w:"value"==a&&"INPUT"==this[0].nodeName?this.val():!(c=this[0].getAttribute(a))&&a in this[0]?this[0][a]:c:this.each(function(c){if(1===this.nodeType)if(e(a))for(x in a)s(this,x,a[x]);else s(this,a,r(this,b,c,this.getAttribute(a)))})},removeAttr:function(a){return this.each(function(){1===this.nodeType&&s(this,a)})},prop:function(a,b){return b===w?this[0]&&this[0][a]:this.each(function(c){this[a]=r(this,b,c,this[a])})},data:function(a,b){var c=this.attr("data-"+k(a),b);return null!==c?u(c):w},val:function(a){return a===w?this[0]&&(this[0].multiple?y(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(b){this.value=r(this,a,b,this.value)})},offset:function(a){if(a)return this.each(function(b){var c=y(this),d=r(this,a,b,c.offset()),e=c.offsetParent().offset(),f={top:d.top-e.top,left:d.left-e.left};"static"==c.css("position")&&(f.position="relative"),c.css(f)});if(0==this.length)return null;var b=this[0].getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:Math.round(b.width),height:Math.round(b.height)}},css:function(b,c){if(arguments.length<2&&"string"==typeof b)return this[0]&&(this[0].style[A(b)]||I(this[0],"").getPropertyValue(b));var d="";if("string"==a(b))c||0===c?d=k(b)+":"+m(b,c):this.each(function(){this.style.removeProperty(k(b))});else for(x in b)b[x]||0===b[x]?d+=k(x)+":"+m(x,b[x])+";":this.each(function(){this.style.removeProperty(k(x))});return this.each(function(){this.style.cssText+=";"+d})},index:function(a){return a?this.indexOf(y(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return C.some.call(this,function(a){return this.test(t(a))},l(a))},addClass:function(a){return this.each(function(b){z=[];var c=t(this),d=r(this,a,b,c);d.split(/\s+/g).forEach(function(a){y(this).hasClass(a)||z.push(a)},this),z.length&&t(this,c+(c?" ":"")+z.join(" "))})},removeClass:function(a){return this.each(function(b){return a===w?t(this,""):(z=t(this),r(this,a,b,z).split(/\s+/g).forEach(function(a){z=z.replace(l(a)," ")}),t(this,z.trim()),void 0)})},toggleClass:function(a,b){return this.each(function(c){var d=y(this),e=r(this,a,c,t(this));e.split(/\s+/g).forEach(function(a){(b===w?!d.hasClass(a):b)?d.addClass(a):d.removeClass(a)})})},scrollTop:function(){return this.length?"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY:void 0},position:function(){if(this.length){var a=this[0],b=this.offsetParent(),c=this.offset(),d=M.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(y(a).css("margin-top"))||0,c.left-=parseFloat(y(a).css("margin-left"))||0,d.top+=parseFloat(y(b[0]).css("border-top-width"))||0,d.left+=parseFloat(y(b[0]).css("border-left-width"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||F.body;a&&!M.test(a.nodeName)&&"static"==y(a).css("position");)a=a.offsetParent;return a})}},y.fn.detach=y.fn.remove,["width","height"].forEach(function(a){y.fn[a]=function(b){var e,f=this[0],g=a.replace(/./,function(a){return a[0].toUpperCase()});return b===w?c(f)?f["inner"+g]:d(f)?f.documentElement["offset"+g]:(e=this.offset())&&e[a]:this.each(function(c){f=y(this),f.css(a,r(this,b,c,f[a]()))})}}),O.forEach(function(b,c){var d=c%2;y.fn[b]=function(){var b,e,f=y.map(arguments,function(c){return b=a(c),"object"==b||"array"==b||null==c?c:Y.fragment(c)}),g=this.length>1;return f.length<1?this:this.each(function(a,b){e=d?b:b.parentNode,b=0==c?b.nextSibling:1==c?b.firstChild:2==c?b:null,f.forEach(function(a){if(g)a=a.cloneNode(!0);else if(!e)return y(a).remove();v(e.insertBefore(a,b),function(a){null!=a.nodeName&&"SCRIPT"===a.nodeName.toUpperCase()&&(!a.type||"text/javascript"===a.type)&&!a.src&&window.eval.call(window,a.innerHTML)})})})},y.fn[d?b+"To":"insert"+(c?"Before":"After")]=function(a){return y(a)[b](this),this}}),Y.Z.prototype=y.fn,Y.uniq=B,Y.deserializeValue=u,y.zepto=Y,y}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/Kindle\/([\d.]+)/),k=a.match(/Silk\/([\d._]+)/),l=a.match(/(BlackBerry).*Version\/([\d.]+)/),m=a.match(/(BB10).*Version\/([\d.]+)/),n=a.match(/(RIM\sTablet\sOS)\s([\d.]+)/),o=a.match(/PlayBook/),p=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),q=a.match(/Firefox\/([\d.]+)/);(c.webkit=!!d)&&(c.version=d[1]),e&&(b.android=!0,b.version=e[2]),g&&(b.ios=b.iphone=!0,b.version=g[2].replace(/_/g,".")),f&&(b.ios=b.ipad=!0,b.version=f[2].replace(/_/g,".")),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),l&&(b.blackberry=!0,b.version=l[2]),m&&(b.bb10=!0,b.version=m[2]),n&&(b.rimtabletos=!0,b.version=n[2]),o&&(c.playbook=!0),j&&(b.kindle=!0,b.version=j[1]),k&&(c.silk=!0,c.version=k[1]),!k&&b.android&&a.match(/Kindle Fire/)&&(c.silk=!0),p&&(c.chrome=!0,c.version=p[1]),q&&(c.firefox=!0,c.version=q[1]),b.tablet=!!(f||o||e&&!a.match(/Mobile/)||q&&a.match(/Tablet/)),b.phone=!b.tablet&&!!(e||g||h||l||m||p&&a.match(/Android/)||p&&a.match(/CriOS\/([\d.]+)/)||q&&a.match(/Mobile/))}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a){function b(a){return a._zid||(a._zid=n++)}function c(a,c,f,g){if(c=d(c),c.ns)var h=e(c.ns);return(m[b(a)]||[]).filter(function(a){return!(!a||c.e&&a.e!=c.e||c.ns&&!h.test(a.ns)||f&&b(a.fn)!==b(f)||g&&a.sel!=g)})}function d(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function e(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function f(b,c,d){"string"!=a.type(b)?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function g(a,b){return a.del&&("focus"==a.e||"blur"==a.e)||!!b}function h(a){return p[a]||a}function i(c,e,i,j,k,l){var n=b(c),o=m[n]||(m[n]=[]);f(e,i,function(b,e){var f=d(b);f.fn=e,f.sel=j,f.e in p&&(e=function(b){var c=b.relatedTarget;return!c||c!==this&&!a.contains(this,c)?f.fn.apply(this,arguments):void 0}),f.del=k&&k(e,b);var i=f.del||e;f.proxy=function(a){var b=i.apply(c,[a].concat(a.data));return b===!1&&(a.preventDefault(),a.stopPropagation()),b},f.i=o.length,o.push(f),c.addEventListener(h(f.e),f.proxy,g(f,l))})}function j(a,d,e,i,j){var k=b(a);f(d||"",e,function(b,d){c(a,b,d,i).forEach(function(b){delete m[k][b.i],a.removeEventListener(h(b.e),b.proxy,g(b,j))})})}function k(b){var c,d={originalEvent:b};for(c in b)!s.test(c)&&void 0!==b[c]&&(d[c]=b[c]);return a.each(t,function(a,c){d[a]=function(){return this[c]=q,b[a].apply(b,arguments)},d[c]=r}),d}function l(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var m=(a.zepto.qsa,{}),n=1,o={},p={mouseenter:"mouseover",mouseleave:"mouseout"};o.click=o.mousedown=o.mouseup=o.mousemove="MouseEvents",a.event={add:i,remove:j},a.proxy=function(c,d){if(a.isFunction(c)){var e=function(){return c.apply(d,arguments)};return e._zid=b(c),e}if("string"==typeof d)return a.proxy(c[d],c);throw new TypeError("expected function")},a.fn.bind=function(a,b){return this.each(function(){i(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){j(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){i(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return j(d,b,a),c}})})};var q=function(){return!0},r=function(){return!1},s=/^([A-Z]|layer[XY]$)/,t={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){return this.each(function(e,f){i(f,c,d,b,function(c){return function(d){var e,g=a(d.target).closest(b,f).get(0);return g?(e=a.extend(k(d),{currentTarget:g,liveFired:f}),c.apply(g,[e].concat([].slice.call(arguments,1)))):void 0}})})},a.fn.undelegate=function(a,b,c){return this.each(function(){j(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d){return!c||a.isFunction(c)?this.bind(b,c||d):this.delegate(c,b,d)},a.fn.off=function(b,c,d){return!c||a.isFunction(c)?this.unbind(b,c||d):this.undelegate(c,b,d)},a.fn.trigger=function(b,c){return("string"==typeof b||a.isPlainObject(b))&&(b=a.Event(b)),l(b),b.data=c,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,d){var e,f;return this.each(function(g,h){e=k("string"==typeof b?a.Event(b):b),e.data=d,e.target=h,a.each(c(h,b.type||b),function(a,b){return f=b.proxy(e),e.isImmediatePropagationStopped()?!1:void 0})}),f},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.trigger(b)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.each(function(){try{this[b]()}catch(a){}}),this}}),a.Event=function(a,b){"string"!=typeof a&&(b=a,a=b.type);var c=document.createEvent(o[a]||"Events"),d=!0;if(b)for(var e in b)"bubbles"==e?d=!!b[e]:c[e]=b[e];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c.isDefaultPrevented=function(){return this.defaultPrevented},c}}(Zepto),function(a){function b(b,c,d){var e=a.Event(c);return a(b).trigger(e,d),!e.defaultPrevented}function c(a,c,d,e){return a.global?b(c||s,d,e):void 0}function d(b){b.global&&0===a.active++&&c(b,null,"ajaxStart")}function e(b){b.global&&!--a.active&&c(b,null,"ajaxStop")}function f(a,b){var d=b.context;return b.beforeSend.call(d,a,b)===!1||c(b,d,"ajaxBeforeSend",[a,b])===!1?!1:(c(b,d,"ajaxSend",[a,b]),void 0)}function g(a,b,d){var e=d.context,f="success";d.success.call(e,a,f,b),c(d,e,"ajaxSuccess",[b,d,a]),i(f,b,d)}function h(a,b,d,e){var f=e.context;e.error.call(f,d,b,a),c(e,f,"ajaxError",[d,e,a]),i(b,d,e)}function i(a,b,d){var f=d.context;d.complete.call(f,b,a),c(d,f,"ajaxComplete",[b,d]),e(d)}function j(){}function k(a){return a&&(a=a.split(";",2)[0]),a&&(a==x?"html":a==w?"json":u.test(a)?"script":v.test(a)&&"xml")||"text"}function l(a,b){return(a+"&"+b).replace(/[&?]{1,2}/,"?")}function m(b){b.processData&&b.data&&"string"!=a.type(b.data)&&(b.data=a.param(b.data,b.traditional)),b.data&&(!b.type||"GET"==b.type.toUpperCase())&&(b.url=l(b.url,b.data))}function n(b,c,d,e){var f=!a.isFunction(c);return{url:b,data:f?c:void 0,success:f?a.isFunction(d)?d:void 0:c,dataType:f?e||d:d}}function o(b,c,d,e){var f,g=a.isArray(c);a.each(c,function(c,h){f=a.type(h),e&&(c=d?e:e+"["+(g?"":c)+"]"),!e&&g?b.add(h.name,h.value):"array"==f||!d&&"object"==f?o(b,h,d,c):b.add(c,h)})}var p,q,r=0,s=window.document,t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,u=/^(?:text|application)\/javascript/i,v=/^(?:text|application)\/xml/i,w="application/json",x="text/html",y=/^\s*$/;a.active=0,a.ajaxJSONP=function(b){if("type"in b){var c,d="jsonp"+ ++r,e=s.createElement("script"),i=function(){clearTimeout(c),a(e).remove(),delete window[d]},k=function(a){i(),a&&"timeout"!=a||(window[d]=j),h(null,a||"abort",l,b)},l={abort:k};return f(l,b)===!1?(k("abort"),!1):(window[d]=function(a){i(),g(a,l,b)},e.onerror=function(){k("error")},e.src=b.url.replace(/=\?/,"="+d),a("head").append(e),b.timeout>0&&(c=setTimeout(function(){k("timeout")},b.timeout)),l)}return a.ajax(b)},a.ajaxSettings={type:"GET",beforeSend:j,success:j,error:j,complete:j,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:w,xml:"application/xml, text/xml",html:x,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},a.ajax=function(b){var c=a.extend({},b||{});for(p in a.ajaxSettings)void 0===c[p]&&(c[p]=a.ajaxSettings[p]);d(c),c.crossDomain||(c.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(c.url)&&RegExp.$2!=window.location.host),c.url||(c.url=window.location.toString()),m(c),c.cache===!1&&(c.url=l(c.url,"_="+Date.now()));var e=c.dataType,i=/=\?/.test(c.url);if("jsonp"==e||i)return i||(c.url=l(c.url,"callback=?")),a.ajaxJSONP(c);var n,o=c.accepts[e],r={},s=/^([\w-]+:)\/\//.test(c.url)?RegExp.$1:window.location.protocol,t=c.xhr();c.crossDomain||(r["X-Requested-With"]="XMLHttpRequest"),o&&(r.Accept=o,o.indexOf(",")>-1&&(o=o.split(",",2)[0]),t.overrideMimeType&&t.overrideMimeType(o)),(c.contentType||c.contentType!==!1&&c.data&&"GET"!=c.type.toUpperCase())&&(r["Content-Type"]=c.contentType||"application/x-www-form-urlencoded"),c.headers=a.extend(r,c.headers||{}),t.onreadystatechange=function(){if(4==t.readyState){t.onreadystatechange=j,clearTimeout(n);var b,d=!1;if(t.status>=200&&t.status<300||304==t.status||0==t.status&&"file:"==s){e=e||k(t.getResponseHeader("content-type")),b=t.responseText;try{"script"==e?(1,eval)(b):"xml"==e?b=t.responseXML:"json"==e&&(b=y.test(b)?null:a.parseJSON(b))}catch(f){d=f}d?h(d,"parsererror",t,c):g(b,t,c)}else h(null,t.status?"error":"abort",t,c)}};var u="async"in c?c.async:!0;t.open(c.type,c.url,u);for(q in c.headers)t.setRequestHeader(q,c.headers[q]);return f(t,c)===!1?(t.abort(),!1):(c.timeout>0&&(n=setTimeout(function(){t.onreadystatechange=j,t.abort(),h(null,"timeout",t,c)},c.timeout)),t.send(c.data?c.data:null),t)},a.get=function(){return a.ajax(n.apply(null,arguments))},a.post=function(){var b=n.apply(null,arguments);return b.type="POST",a.ajax(b)},a.getJSON=function(){var b=n.apply(null,arguments);return b.dataType="json",a.ajax(b)},a.fn.load=function(b,c,d){if(!this.length)return this;var e,f=this,g=b.split(/\s/),h=n(b,c,d),i=h.success;return g.length>1&&(h.url=g[0],e=g[1]),h.success=function(b){f.html(e?a("<div>").html(b.replace(t,"")).find(e):b),i&&i.apply(f,arguments)},a.ajax(h),this};var z=encodeURIComponent;a.param=function(a,b){var c=[];return c.add=function(a,b){this.push(z(a)+"="+z(b))},o(c,a,b),c.join("&").replace(/%20/g,"+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b,c=[];return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){b=a(this);var d=b.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=d&&"reset"!=d&&"button"!=d&&("radio"!=d&&"checkbox"!=d||this.checked)&&c.push({name:b.attr("name"),value:b.val()})}),c},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);
else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a,b){function c(a){return d(a.replace(/([a-z])([A-Z])/,"$1-$2"))}function d(a){return a.toLowerCase()}function e(a){return f?f+a:d(a)}var f,g,h,i,j,k,l,m,n="",o={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},p=window.document,q=p.createElement("div"),r=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,s={};a.each(o,function(a,c){return q.style[a+"TransitionProperty"]!==b?(n="-"+d(a)+"-",f=c,!1):void 0}),g=n+"transform",s[h=n+"transition-property"]=s[i=n+"transition-duration"]=s[j=n+"transition-timing-function"]=s[k=n+"animation-name"]=s[l=n+"animation-duration"]=s[m=n+"animation-timing-function"]="",a.fx={off:f===b&&q.style.transitionProperty===b,speeds:{_default:400,fast:200,slow:600},cssPrefix:n,transitionEnd:e("TransitionEnd"),animationEnd:e("AnimationEnd")},a.fn.animate=function(b,c,d,e){return a.isPlainObject(c)&&(d=c.easing,e=c.complete,c=c.duration),c&&(c=("number"==typeof c?c:a.fx.speeds[c]||a.fx.speeds._default)/1e3),this.anim(b,c,d,e)},a.fn.anim=function(d,e,f,n){var o,p,q,t={},u="",v=this,w=a.fx.transitionEnd;if(e===b&&(e=.4),a.fx.off&&(e=0),"string"==typeof d)t[k]=d,t[l]=e+"s",t[m]=f||"linear",w=a.fx.animationEnd;else{p=[];for(o in d)r.test(o)?u+=o+"("+d[o]+") ":(t[o]=d[o],p.push(c(o)));u&&(t[g]=u,p.push(g)),e>0&&"object"==typeof d&&(t[h]=p.join(", "),t[i]=e+"s",t[j]=f||"linear")}return q=function(b){if("undefined"!=typeof b){if(b.target!==b.currentTarget)return;a(b.target).unbind(w,q)}a(this).css(s),n&&n.call(this)},e>0&&this.bind(w,q),this.size()&&this.get(0).clientLeft,this.css(t),0>=e&&setTimeout(function(){v.each(function(){q.call(this)})},0),this},q=null}(Zepto),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.3";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2);return x.map(a,function(a){return(x.isFunction(b)?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b){return x.isEmpty(b)?[]:x.filter(a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d.computed>g&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;e>c.call(d,a[h])?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.bindAll=function(a){var b=h.call(arguments,1);return 0==b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return 1>--a?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==b+"";case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=F(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),x.isFunction=function(a){return"function"==typeof a},x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+(0|Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};G.unescape=x.invert(G.escape);var H={escape:RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=""+ ++I;return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){c=x.defaults({},c,x.templateSettings);var d=RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(L,function(a){return"\\"+K[a]}),c&&(f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(f+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),g&&(f+="';\n"+g+"\n__p+='"),e=h+b.length,b}),f+="';\n",c.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=Function(c.variable||"obj","_",f)}catch(h){throw h.source=f,h}if(b)return g(b,x);var i=function(a){return g.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+f+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="0.9.10";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c)for(var e in c)a[b].apply(a,[e,c[e]].concat(d));else{if(!i.test(c))return!0;for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d))}},k=function(a,b){var c,d=-1,e=a.length;switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0]);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0],b[1]);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0],b[1],b[2]);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},l=a.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!j(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c),this},off:function(a,b,c){var d,e,f,g,i,k,l,m;if(!this._events||!j(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,k=g.length;k>i;i++)if(a=g[i],d=this._events[a]){if(f=[],b||c)for(l=0,m=d.length;m>l;l++)e=d[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&f.push(e);this._events[a]=f}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),e=a._listenerId||(a._listenerId=h.uniqueId("l"));return d[e]=a,a.on(b,"object"==typeof b?this:c,this),this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a)a.off(b,"object"==typeof b?this:c,this),b||c||delete d[a._listenerId];else{"object"==typeof b&&(c=this);for(var e in d)d[e].off(b,c,this);this._listeners={}}return this}}};l.bind=l.on,l.unbind=l.off,h.extend(a,l);var m=a.Model=function(a,b){var c,d=a||{};this.cid=h.uniqueId("c"),this.attributes={},b&&b.collection&&(this.collection=b.collection),b&&b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};h.extend(m.prototype,l,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success;return a.success=function(a,c,d){return a.set(a.parse(c,d),d)?(b&&b(a,c,d),void 0):!1},this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g,i=this.attributes;return null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!d||c&&c.wait||this.set(d,c)?(c=h.extend({validate:!0},c),this._validate(d,c)?(d&&c.wait&&(this.attributes=h.extend({},i,d)),void 0===c.parse&&(c.parse=!0),e=c.success,c.success=function(a,b,c){a.attributes=i;var f=a.parse(b,c);return c.wait&&(f=h.extend(d||{},f)),h.isObject(f)&&!a.set(f,c)?!1:(e&&e(a,b,c),void 0)},f=this.isNew()?"create":c.patch?"patch":"update","patch"===f&&(c.attrs=d),g=this.sync(f,this,c),d&&c.wait&&(this.attributes=i),g):!1):!1},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(a,b,e){(e.wait||a.isNew())&&d(),c&&c(a,b,e)},this.isNew())return a.success(this,null,a),!1;var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||F();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return!this.validate||!this.validate(this.attributes,a)},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,b||{}),!1):!0}});var n=a.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))};h.extend(n.prototype,l,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,f,i,j,k,l,m,n,o;for(l=[],m=b.at,n=this.comparator&&null==m&&0!=b.sort,o=h.isString(this.comparator)?this.comparator:null,c=0,d=a.length;d>c;c++)(f=this._prepareModel(i=a[c],b))?(j=this.get(f))?b.merge&&(j.set(i===f?f.attributes:i,b),n&&!k&&j.hasChanged(o)&&(k=!0)):(l.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)):this.trigger("invalid",this,i,b);if(l.length&&(n&&(k=!0),this.length+=l.length,null!=m?g.apply(this.models,[m,0].concat(l)):e.apply(this.models,l)),k&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=l.length;d>c;c++)(f=l[c]).trigger("add",f,this,b);return k&&this.trigger("sort",this,b),this},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[a.id||a.cid||a[this._idAttr]||a])},at:function(a){return this.models[a]},where:function(a){return h.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return h.invoke(this.models,"get",a)},update:function(a,b){b=h.extend({add:!0,merge:!0,remove:!0},b),b.parse&&(a=this.parse(a,b));var c,d,e,f,g=[],i=[],j={};if(h.isArray(a)||(a=a?[a]:[]),b.add&&!b.remove)return this.add(a,b);for(d=0,e=a.length;e>d;d++)c=a[d],f=this.get(c),b.remove&&f&&(j[f.cid]=!0),(b.add&&!f||b.merge&&f)&&g.push(c);if(b.remove)for(d=0,e=this.models.length;e>d;d++)c=this.models[d],j[c.cid]||i.push(c);return i.length&&this.remove(i,b),g.length&&this.add(g,b),this},reset:function(a,b){b||(b={}),b.parse&&(a=this.parse(a,b));for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models.slice(),this._reset(),a&&this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success;return a.success=function(a,c,d){var e=d.update?"update":"reset";a[e](c,d),b&&b(a,c,d)},this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(a,b,e){e.wait&&c.add(a,e),d&&d(a,b,e)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:!1},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)}});var o=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(o,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var p=["groupBy","countBy","sortBy"];h.each(p,function(a){n.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var q=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},r=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,t=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(q.prototype,l,{initialize:function(){},route:function(b,c,d){return h.isRegExp(b)||(b=this._routeToRegExp(b)),d||(d=this[c]),a.history.route(b,h.bind(function(e){var f=this._extractParameters(b,e);d&&d.apply(this,f),this.trigger.apply(this,["route:"+c].concat(f)),this.trigger("route",c,f),a.history.trigger("route",this,c,f)},this)),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes)for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])},_routeToRegExp:function(a){return a=a.replace(u,"\\$&").replace(r,"(?:$1)?").replace(s,function(a,b){return b?a:"([^/]+)"}).replace(t,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var v=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},w=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,y=/msie [\w.]+/,z=/\/$/;v.started=!1,h.extend(v.prototype,l,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(z,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(w,"")},start:function(b){if(v.started)throw new Error("Backbone.history has already been started");v.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=y.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(x,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(w,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),v.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!v.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new v;var A=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},B=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];h.extend(A.prototype,l,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(a||(a=h.result(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(B),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,C)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}});var D={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.sync=function(b,c,d){var e=D[b];
h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||F()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1);var i=d.success;d.success=function(a){i&&i(c,a,d),c.trigger("sync",c,a,d)};var j=d.error;d.error=function(a){j&&j(c,a,d),c.trigger("error",c,a,d)};var k=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,k,d),k},a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var E=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};m.extend=n.extend=q.extend=A.extend=v.extend=E;var F=function(){throw new Error('A "url" property or function must be specified')}}.call(this),window.JST={"category.info":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/category.info.blade";try{with(__.locals)__.line=1,__.col=1,servers.length?(__.line=4,__.col=3,__.push('<div class="info no-tracks">No tracks selected, add tracks from a server:'),__.line=5,__.col=5,__.push('<ul class="playlists">'),__.line=6,__.col=7,servers.each(function(a){__.line=7,__.col=9;var b=a.id;__.line=8,__.col=9;var c=a.get("status");__.line=9,__.col=9,__.push("<li"),__.r.attrs({id:{v:b,e:1},"class":{v:c,e:1}},__),__.push(">"),__.line=10,__.col=11,__.push("<a"),__.r.attrs({href:{v:"/directory/"+b+"/0",e:1}},__),__.push(">"),__.line=11,__.col=13,__.push(__.r.escape(a.get("name"))+"</a>"),__.line=12,__.col=11,__.push('<div class="loading">'),__.line=13,__.col=13,__.push("[ loading"),__.line=14,__.col=13,__.push('<i class="icon-refresh icon-spin"></i>'),__.line=15,__.col=13,__.push("]</div></li>")}),__.push("</ul></div>")):(__.line=2,__.col=3,__.push('<div class="info no-server">No upnp media servers detected on the network, add a server to begin</div>'))}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.popup":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/category.popup.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="top-box">'),__.line=2,__.col=3,__.push('<h1 class="play">'),__.line=3,__.col=5,__.push('<i class="icon-play-circle"></i>'),__.line=4,__.col=5,__.push('<span class="divider">| </span>'),__.line=5,__.col=5,__.push('<span class="next">Play Next</span></h1>'),__.line=6,__.col=3,__.push('<h1 class="add"> Add to playlist</h1>'),__.line=7,__.col=3,__.push('<h1 class="new"> Create new playlist</h1></div>'),__.line=8,__.col=1,__.push('<div class="bottom-box add"></div>'),__.line=9,__.col=1,__.push('<div class="bottom-box new">'),__.line=10,__.col=3,__.push("<form>"),__.line=11,__.col=5,__.push('<input type="text" class="name"/>'),__.line=12,__.col=5,__.push('<input type="submit" class="submit"/></form></div>'),__.line=13,__.col=1,__.push('<span class="cancel">cancel</span>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.nav":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/category.nav.blade";try{with(__.locals)__.line=1,__.col=1,__.push("<nav>"),__.line=2,__.col=3,__.push('<a href="/category/Artist" class="active Artist" cat="Artist">Artists</a>'),__.line=3,__.col=3,__.push('<a href="/category/Album" cat="Album" class="Album">Albums</a>'),__.line=4,__.col=3,__.push('<a href="/category/Title" cat="Title" class="Title">Tracks</a></nav>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.show":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/category.show.blade";try{with(__.locals){__.line=1,__.col=1;var title=model.getTitle();__.line=2,__.col=1;var docs=model.get("docs");__.line=3,__.col=1;var name;__.line=5,__.col=1,title&&(__.line=6,__.col=3,__.push('<span class="title">'),__.line=7,__.col=5,__.push(__.r.escape(title)+"</span>"));var current=jumper&&docs&&docs.length>20?" ":String.fromCharCode(99999);__.line=9,__.col=1,__.push('<div class="category-list">'),__.line=10,__.col=3,__.push("<ul>"),__.line=11,__.col=5,__.r.foreach(__,docs,function(a){__.line=12,__.col=7,name=a.Title||a,__.line=13,__.col=7,name.toUpperCase()[0]>current&&(__.line=14,__.col=9,current=name.toUpperCase()[0],__.line=15,__.col=9,__.push('<li class="jumper"'),__.r.attrs({id:{v:"jumper"+current,e:1}},__),__.push("></li>")),__.line=17,__.col=7,a._id?(__.line=18,__.col=9,__.push("<li"),__.r.attrs({id:{v:a._id,e:1}},__),__.push(">"+__.r.escape(name)+"</li>")):(__.line=20,__.col=9,__.push("<li>"+__.r.escape(name)+"</li>"))}),__.push("</ul></div>")}}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},loader:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/loader.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="icon-spinner icon-spin loader"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},menu:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/menu.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="musicLink">'),__.line=2,__.col=3,__.push('<i class="icon-chevron-left"></i>'),__.line=3,__.col=3,__.push("Music </div>"),__.line=4,__.col=1,__.push('<div class="lists">'),__.line=5,__.col=3,__.push("<h1>Play To</h1>"),__.line=6,__.col=3,__.push('<ul class="renderers">'),__.line=7,__.col=5,renderers.each(function(a){__.line=8,__.col=7;var b=a.get("uuid");__.line=9,__.col=7,__.push("<li"),__.r.attrs({id:{v:b,e:1}},__),__.push(">"),__.line=10,__.col=9,__.push("<span>"),__.line=11,__.col=11,__.push(__.r.escape(a.get("name"))+"</span>"),__.line=12,__.col=9,__.push('<i class="icon-circle"></i></li>')}),__.push("</ul>"),__.line=14,__.col=3,__.push("<h1>Playlists</h1>"),__.line=15,__.col=3,__.push('<ul class="playlists">'),__.line=16,__.col=5,playlists.each(function(a){__.line=17,__.col=7;var b=a.get("_id");__.line=18,__.col=7,__.push("<li"),__.r.attrs({id:{v:b,e:1}},__),__.push(">"),__.line=19,__.col=9,__.push("<a"),__.r.attrs({href:{v:"/playlist/"+b,e:1}},__),__.push(">"),__.line=20,__.col=11,__.push(__.r.escape(a.get("name"))+"</a>"),__.line=21,__.col=9,__.push('<i class="icon-volume-up"></i>'),__.line=22,__.col=9,a.get("uuid")||(__.line=23,__.col=11,__.push('<i class="icon-trash"></i>')),__.push("</li>")}),__.push("</ul>"),__.line=25,__.col=3,__.push("<h1>Servers</h1>"),__.line=26,__.col=3,__.push('<ul class="playlists servers">'),__.line=27,__.col=5,servers.each(function(a){__.line=28,__.col=7;var b=a.id;__.line=29,__.col=7;var c=a.get("status");__.line=30,__.col=7,__.push("<li"),__.r.attrs({id:{v:"ms"+b,e:1},"class":{v:c,e:1}},__),__.push(">"),__.line=31,__.col=9,__.push("<a"),__.r.attrs({href:{v:"/directory/"+b+"/0",e:1}},__),__.push(">"),__.line=32,__.col=11,__.push(__.r.escape(a.get("name"))),__.line=33,__.col=11,__.push('<i class="icon-refresh icon-spin"></i></a></li>')}),__.push("</ul></div>")}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"directory.container":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/directory.container.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="popup server">'),__.line=2,__.col=3,__.push("<h1>Add tracks from current directory?</h1>"),__.line=3,__.col=3,__.push('<h2 class="ok">ok</h2>'),__.line=4,__.col=3,__.push('<h2 class="cancel">cancel</h2></div>'),__.line=5,__.col=1,__.push('<div id="category-container"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},header:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/header.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="nav-wrap">'),__.line=2,__.col=3,__.push('<span class="menuLink icon-reorder"></span>'),__.line=3,__.col=3,__.push('<div id="subnav"></div></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"player.tab":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/player.tab.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="playing">'),__.line=2,__.col=3,__.push('<a class="title">Now Playing</a>'),__.line=3,__.col=3,__.push('<i class="icon-play play"></i>'),__.line=4,__.col=3,__.push('<i class="icon-chevron-right next"></i>'),__.line=5,__.col=3,__.push('<div class="ball"></div></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"playlist.dropdown":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/playlist.dropdown.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<ul class="dropDown closed">'),__.line=2,__.col=3,__.push('<li class="current">'),__.line=3,__.col=5,__.push(__.r.escape(currentList.get("name"))),__.line=4,__.col=5,playlists.length>1&&(__.line=5,__.col=7,__.push('<i class="icon-angle-down down"></i>')),__.push("</li>"),__.line=6,__.col=3,playlists.each(function(a){__.line=7,__.col=5;var b=a.get("_id");__.line=8,__.col=5,b!==currentList.get("_id")&&(__.line=9,__.col=7,__.push('<li class="option">'),__.line=10,__.col=9,__.push("<a"),__.r.attrs({href:{v:"/playlist/"+b,e:1}},__),__.push(">"),__.line=11,__.col=11,__.push(__.r.escape(a.get("name"))+"</a></li>"))}),__.push("</ul>")}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},popup:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/popup.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="top-box">'),__.line=2,__.col=3,__.push("<h1>add to now playing</h1>"),__.line=3,__.col=3,__.push("<h1>add to ...</h1>"),__.line=4,__.col=3,__.push("<h1>add to new list</h1>"),__.line=5,__.col=3,__.push("<span>cancel</span></div>"),__.line=6,__.col=1,__.push('<div class="bottom-box"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"server.menu":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/server.menu.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="directory-button refresh">'),__.line=2,__.col=3,__.push('<div class="refresh">'),__.line=3,__.col=5,__.push("Refresh"),__.line=4,__.col=5,__.push('<i class="icon-refresh"></i></div>'),__.line=5,__.col=3,__.push('<div class="load">'),__.line=6,__.col=5,__.push("loading"),__.line=7,__.col=5,__.push('<i class="icon-refresh icon-spin"></i></div></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.container":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/category.container.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="popup"></div>'),__.line=2,__.col=1,__.push('<div id="category-container"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"track.list":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/test/wupnp/templates/track.list.blade";try{with(__.locals){__.line=1,__.col=1;var docs=collection.toJSON();__.line=3,__.col=1,__.push('<div class="track-list">'),__.line=4,__.col=3,__.push("<ul>"),__.line=5,__.col=5,__.r.foreach(__,docs,function(a){__.line=6,__.col=7,__.push("<li"),__.r.attrs({id:{v:a._id,e:1},position:{v:a.position,e:1}},__),__.push(">"),__.line=7,__.col=9,__.push('<div class="swipeEl">'),__.line=8,__.col=11,__.push('<div class="track-info">'),__.line=9,__.col=13,__.push('<div class="track-title">'+__.r.escape(a.Title)+"</div>"),__.line=10,__.col=13,__.push('<div class="more">'),__.line=11,__.col=15,__.push(__.r.escape(a.Artist+" - "+a.Album)+"</div></div>"),__.line=12,__.col=11,__.push('<div class="swipeCover">'),__.line=13,__.col=13,__.push("<h1>Undo</h1></div></div></li>")}),__.push("</ul></div>")}}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)}},Wu={Views:{},Models:{},Collections:{},Cache:{Models:{},Views:{},Collections:{}},Routers:{},init:function(){window.Socket=io.connect("/controller"),this.Cache.Models.category=new Wu.Models.category,this.Cache.Models.directory=new Wu.Models.directory,this.Cache.Models.player=new Wu.Models.player,this.Cache.Collections.renderers=new Wu.Collections.renderers,Wu.Cache.Categories=new Wu.Routers.Categories,Wu.Cache.Collections.playlists=new Wu.Collections.playlists,Wu.Cache.Collections.servers=new Wu.Collections.servers,Wu.Cache.Views.toastMaster=new Wu.Views.toastMaster,this.Cache.Collections.servers.reset(bootstrapServers),this.Cache.Collections.renderers.reset(bootstrapRenderers),this.Cache.Collections.playlists.reset(bootstrapPlaylists),$(document).on("click","a:not(.data-bypass)",function(a){a.preventDefault(),Backbone.history.navigate($(a.target).attr("href"),{trigger:!0})}),$(document).on("swipeRight",".category",function(){window.history.back()}),Wu.Layout.init(),Backbone.history.start({pushState:!0})}},window.addEventListener("load",function(){FastClick.attach(document.body)},!1),$(document).ready(function(){window.Wu=Wu,Wu.init()});var Drawer=function(){function a(a){return a.touches?a.touches[0].pageY:a.pageY}function b(a){return a.touches?a.touches[0].pageX:a.pageX}function c(a){var b=a.touches?a.touches[0].pageX:a.pageX,c=a.touches?a.touches[0].pageY:a.pageY,d=b-j.offset().left,e=c-j.offset().top;u&&e>h&&f>e&&g>d&&d>i&&(n=a.timeStamp,m="horizontal"==l.drag?b:c,o=!0)}function d(a){if(o){a.preventDefault();var b=k(a),c=0===m?0:Math.abs(b-m),d=l.maxTime,e=l.maxDistance;if(currentTime=a.timeStamp,0!==n&&d>currentTime-n&&c>e){if(m>b){var f="horizontal"==l.drag?"left":"up";j.trigger(f)}if(b>m){var f="horizontal"==l.drag?"right":"down";j.trigger(f),o=!1}n=0,m=0}}else"full"==p?a.preventDefault():"partial"==p&&(a.overide||a.preventDefault())}function e(){n=0,m=0,o=!1}var f,g,h,i,j,k,l={maxTime:1e3,maxDistance:20,scopeEl:$("html"),xPadding:0,yPadding:0,drag:"horizontal"},m=0,n=0,o=!1,p=!1,q="ontouchend"in document,r=q?"touchstart":"mousedown",s=q?"touchmove":"mousemove",t=q?"touchend":"mouseup",u=!0;return{init:function(m){if($.extend(l,m),j=$(l.el),!j||j.length<1)throw"Error: Need to supply a valid target element";h=l.yPadding,i=l.xPadding,g=j.width()+i,f=j.height()+h,l.scopeEl.on(r,c).on(s,d).on(t,e),k="horizontal"==l.drag?b:a,$(".nots").bind(s,function(a){a.xyz=!0}),j.on("toggleDrag",function(a,b){u=void 0===b?!u:b})},toggle:function(a){o=a},lockScroll:function(a){p=a}}}();Wu.Layout={init:function(){this.header=new Wu.Views.header({el:$("#header")}),this.menu=new Wu.Views.menu({collection:Wu.Cache.Collections.renderers,el:$("#menu")}).render(),this.menu.trigger("inserted"),this.footer=new Wu.Views.playerTab({model:Wu.Cache.Models.player,el:$("#pullTab")}).render(),this.footer.trigger("inserted")},setSubHeader:function(a){this.header.setSubHeader(a),this.header.render()},removeSubHeader:function(){this.header.removeSubHeader()},setPage:function(a){this.page&&this.page.unrender(),this.menu.hide(),$("#mask").hide(),$("#page").html(a.render().$el),a.trigger("inserted"),this.page=a}},function(a){function b(a,b,c){function d(){var c=b.blocks;b.blocks={};var d=f.capture(b,b.length,a());return b.blocks=c,d}return c?d():l.isolate(d)}function c(a,b,c){c&&(a.filename=b.filename,a.source=b.source),a.line=b.line,a.col=b.col}function d(a,b,c){var d=a.buf.splice(c,a.buf.length-c);Array.prototype.unshift.apply(a.buf,d);for(var e in b.blocks)b.blocks[e].parent==a&&b.blocks[e].pos>=c&&(b.blocks[e].pos-=c)}function e(a,b){for(var c=a+" ",d=0;d<b-c.length+1;d++)c=" "+c;return c}var f="object"==typeof exports?exports:{},g={},h={},i=function(a,b){return b},j=function(a){return a()},k=function(a,b){return b()},l={attachEvents:i,setDataContext:i,isolate:j,render:j,list:function(a,b,c){var d=[];if(a.observe({added:function(a){d.push(a)}}).stop(),!d.length)return c();for(var e="",f=0;f<d.length;f++)e+=b(d[f]);return e},labelBranch:k,createLandmark:k,finalize:i};f.options={mount:"/views/",loadTimeout:15e3},(f.client="undefined"!=typeof window)&&(window.blade={Runtime:f,LiveUpdate:l,_cachedViews:g,_cb:{},runtime:f}),f.escape=function(a){return null==a?"":new String(a).replace(/&(?!([a-zA-Z]+|(#[0-9]+)|(#[xX][0-9a-fA-F]+));)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},f.attrs=function(a,b){for(var c in a){var d=a[c];if(null==d.v||d.v===!1){if(null==d.a)continue;d.v=d.a,delete d.a}d.v===!0&&(d.v=c),"class"==c&&(d.v instanceof Array&&(d.v=d.v.join(" ")),d.a&&(d.v=(d.v.length>0?d.v+" ":"")+d.a)),d.e?b.push(" "+c+'="'+f.escape(d.v)+'"'):b.push(" "+c+'="'+d.v+'"')}},f.ueid=f.client?1e3:0,f.bind=function(a,b,c,d,e){for(var f="",g=a.split(" "),i=0;i<g.length;i++)f=","+g[i]+" #"+b;h[f.substr(1)]=c;var j="i["+JSON.stringify(a)+"]="+c.toString();if(e){var i=d.length-1;d[i]=d[i].substr(0,d[i].length-3)+";"+j+"-->"}else d.push("<!--"+j+"-->")},f.trigger=a,f.loadTemplate=function(a,b,c,d){function e(a,c){for(var d=0;d<a.length;d++)c?a[d](c):a[d](null,g[b])}function h(a){var c=i._cb[b].cb;delete i._cb[b],j.parentNode.removeChild(j),e(c,new Error("Blade Template ["+b+"] could not be loaded: "+(a?a:"Request timed out")))}if("function"==typeof c&&(d=c,"object"==typeof b?(c=b,b=a,a=""):c=null),"function"==typeof b&&(d=b,b=a,c=null,a=""),b.split("/").pop().indexOf(".")<0&&(b+=".blade"),f.client){if(b=f.resolve(b),g[b])return d(null,g[b]),!0;var i=window.blade;if(i._cb[b])i._cb[b].cb.push(d);else{var j=document.createElement("script");j.type="text/javascript",j.async=!0,j.src=f.options.mount+b;var k=setTimeout(h,f.options.loadTimeout),l=i._cb[b]=function(d,g){if(clearTimeout(k),delete i._cb[b],j.parentNode.removeChild(j),g.length>0)for(var h=0,m=0;m<g.length;m++)f.loadTemplate(a,d+"/"+g[m],c,function(a){return a?e(l.cb,a):(++h==g.length&&e(l.cb),void 0)});else e(l.cb)};l.cb=[d];var m=document.getElementsByTagName("script")[0];m.parentNode.insertBefore(j,m),j.onload=j.onreadystatechange=j.onerror=function(){var a=this.readyState;a&&"loaded"!=a&&"complete"!=a||!i._cb[b]||(clearTimeout(k),h("Request failed"))}}return!1}return c.synchronous=!0,require("./blade").compileFile(a+"/"+b,c,function(a,b){return a?d(a):(d(null,b.template),void 0)}),!0},f.resolve=function(a){if(f.client){var b=document.createElement("div");b.innerHTML='<a href="'+f.escape("./"+a)+'"></a>',b=b.firstChild.href;var c=window.location.href.split("#")[0];return b=b.substr(c.substr(0,c.lastIndexOf("/")).length).replace(/\/[\/]+/g,"/"),"/"==b.charAt(0)&&(b=b.substr(1)),b}},f.include=function(a,b){var c=b.inc,d=b.base,e=b.rel,g=b.filename,h=b.line,i=b.col,j=b.source,k=b.locals;if(b.inc=!0,arguments.length>2){b.locals={};for(var m=2;m<arguments.length;m+=2)b.locals[arguments[m]]=arguments[m+1]}var n=f.loadTemplate(b.base,b.rel+"/"+a,f.compileOptions,function(m,n){if(m)throw m;var o=b.length;n(b.locals,function(m,n){if(m)throw m;b.inc=c,b.base=d,b.rel=e,b.filename=g,b.line=h,b.col=i,b.source=j,b.locals=k,b.bd||(n=f.capture(b,o),b.push(l.labelBranch(b.filename+":"+b.line+":inc:"+a,function(){return n})))},b)});if(!n)throw new Error("Included file ["+b.rel+"/"+a+"] could not be loaded synchronously!")},f.func=function(a,b,c){var d=c.func[a]=b;d.filename=c.filename,d.source=c.source},f.call=function(a,b,c){var d=c.func[a],e=[c];if(null==d)throw new Error("Function '"+a+"' is undefined.");for(var f=3;f<arguments.length;f++)e[f-2]=arguments[f];var g=c.filename,h=c.source;c.filename=d.filename,c.source=d.source,d.apply(b,e),c.filename=g,c.source=h},f.capture=function(a,b){for(var c in a.blocks){var d=a.blocks[c];d.pos>=b&&(!a.block||d.parent==a.block)&&(null==d.parent?a[d.pos]=d.buf.join(""):(d.parent.buf[d.pos]=d.buf.join(""),d.parent.numChildren--),delete a.blocks[c])}return a.splice(b,a.length-b).join("")},f.chunk=function(a,b,c){c.chunk[a]=function(){return f.capture(c,c.length,b.apply(this,arguments))}},f.isolate=function(a,c){c.push(b(a,c))},f.constant=function(a,b,c){c.push(l.labelBranch(c.filename+":"+a,function(){return l.createLandmark({constant:!0},function(){return f.capture(c,c.length,b())})}))},f.preserve=function(a,b,c,d){d.push(l.labelBranch(d.filename+":"+a,function(){return l.createLandmark({preserve:b},function(){return f.capture(d,d.length,c())})}))},f.foreach=function(a,c,d,e){function f(c){var e=c._id||("string"==typeof c?c:null)||l.UNIQUE_LABEL;return l.labelBranch(e,function(){return b(function(){return d.call(c,c)},a,h)})}function g(){return l.labelBranch("else",function(){return e?b(e,a,h):""})}var h=!1;if(c&&"observe"in c)a.push(l.list(c,f,g));else{h=!0;var i="",j=1;for(var k in c)j=0,i+=f(c[k]);a.push(j?g():i)}},f.blockDef=function(a,b,d){var e=b.blocks[a]={parent:b.block||null,buf:[],pos:b.length,numChildren:0},f=["r","blocks","func","locals","cb","base","rel","filename","source"];for(var g in f)e.buf[f[g]]=b[f[g]];if(e.buf.block=e,e.parent&&e.parent.numChildren++,b.push(""),d.length>1)e.paramBlock=d;else try{d(e.buf)}catch(h){throw c(b,e.buf),h}},f.blockRender=function(a,b,e){var f=e.blocks[b];if(null==f)throw new Error("Block '"+b+"' is undefined.");if(null==f.paramBlock)throw new Error("Block '"+b+"' is a regular, non-parameterized block, which cannot be rendered.");for(var g=[f.buf],h=3;h<arguments.length;h++)g[h-2]=arguments[h];"r"==a&&(f.buf.length=0);var i=f.buf.length;try{f.paramBlock.apply(this,g)}catch(j){throw c(e,f.buf,1),j}"p"==a&&d(f,e,i)},f.blockMod=function(a,b,e,f){var g=e.blocks[b];if(null==g)throw new Error("Block '"+b+"' is undefined.");"r"==a&&(delete g.paramBlock,g.buf.length=0);var h=g.buf.length;if(f.length>1)g.paramBlock=f;else try{g.buf.rel=e.rel,g.buf.base=e.base,f(g.buf)}catch(i){throw c(e,g.buf),i}"p"==a&&d(g,e,h)},f.done=function(a){for(var b=!1;!b;){b=!0;for(var c in a.blocks){var d=a.blocks[c];d.done||0!=d.numChildren||(b=!1,null==d.parent?a[d.pos]=d.buf.join(""):(d.parent.buf[d.pos]=d.buf.join(""),d.parent.numChildren--),d.done=!0)}}a.eventHandlers=h,h={},f.client||(f.ueid=0)},f.rethrow=function(a,b){if(null==b&&(b=a),a.lastFilename==b.filename&&null!=a.lastFilename)return a;b.column=b.column||b.col;var c=a.message+"\n    at "+(null==b.filename?"<anonymous>":b.filename)+(null==b.line?"":":"+b.line+(null==b.column?"":":"+b.column));if(null!=b.source){var d=3,f=b.source.split("\n"),g=Math.max(b.line-d,0),h=Math.min(b.line+d,f.length),i=new String(h).length;f=f.slice(g,h),c+="\n\n";for(var j=0;j<f.length;j++)c+=e(j+g+1,i)+(j+g+1==b.line?">	":"|	")+f[j]+"\n"}return a.message=c,a.lastFilename=b.filename,null==a.filename&&null==a.line&&(a.filename=b.filename,a.line=b.line,a.column=b.column),a}}(function(e,t){var r=e.previousSibling,i={},h,n;eval(r.textContent),e.parentNode.removeChild(r);for(r in i)for(h=r.split(" "),n=0;n<h.length;n++)e["on"+h[n]]=i[r];return e["on"+t[0].type].apply(e,t)}),function(a){function b(a){return"tagName"in a?a:a.parentNode}function c(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"}function d(){j=null,k.last&&(k.el.trigger("longTap"),k={})}function e(){j&&clearTimeout(j),j=null}function f(){g&&clearTimeout(g),h&&clearTimeout(h),i&&clearTimeout(i),j&&clearTimeout(j),g=h=i=j=null,k={}}var g,h,i,j,k={},l=750;a(document).ready(function(){var m,n;a(document.body).bind("touchstart",function(c){m=Date.now(),n=m-(k.last||m),k.el=a(b(c.touches[0].target)),g&&clearTimeout(g),k.x1=c.touches[0].pageX,k.y1=c.touches[0].pageY,n>0&&250>=n&&(k.isDoubleTap=!0),k.last=m,j=setTimeout(d,l)}).bind("touchmove",function(a){e(),k.x2=a.touches[0].pageX,k.y2=a.touches[0].pageY,Math.abs(k.x1-k.x2)>10&&a.preventDefault()}).bind("touchend",function(){e(),k.x2&&Math.abs(k.x1-k.x2)>30||k.y2&&Math.abs(k.y1-k.y2)>30?i=setTimeout(function(){k.el.trigger("swipe"),k.el.trigger("swipe"+c(k.x1,k.x2,k.y1,k.y2)),k={}},0):"last"in k&&(h=setTimeout(function(){var b=a.Event("tap");b.cancelTouch=f,k.el.trigger(b),k.isDoubleTap?(k.el.trigger("doubleTap"),k={}):g=setTimeout(function(){g=null,k.el.trigger("singleTap"),k={}},250)},0))}).bind("touchcancel",f),a(window).bind("scroll",f)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}})}(Zepto),Wu.Views.list=Backbone.View.extend({template:JST["category.show"],initialize:function(a){if(a&&a.noJumper||(this.jumper=new Wu.Views.listJumper({list:this.$el,el:$("#alphabet")}),this.$el.on("click",".jumper",$.proxy(this.jumper.show,this.jumper))),a&&a.loader){var b=this;JST.loader({},function(a,c){b.loaderHTML=c}),this.listenTo(this.model,"request",function(){this.$(".loader").show(),$("#mask").show()})}},render:function(){var a=this;return this.template({model:this.model,jumper:this.jumper},function(b,c){$("#mask").hide(),a.$el.html(c),a.jumper&&a.jumper.render(),a.loaderHTML&&a.$el.append(a.loaderHTML);var d=a.$(".title")[0]||a.$("li")[0];d&&d.scrollIntoView()}),this},unrender:function(){this.stopListening(),this.jumper&&this.jumper.unrender()}}),Wu.Views.categories=Backbone.View.extend({template:JST["category.container"],initialize:function(){this.list=new Wu.Views.categoryList({model:this.model,className:"category",parent:this}),this.popup=new Wu.Views.categoryPopup({collection:Wu.Cache.Collections.playlists,model:this.model,className:"popup"}),this.listenTo(this.model,"change:id",function(){this.model.fetch()}),this.listenTo(this.list,"showPopup",function(){this.popup.show()}),this.listenTo(this.list,"rendered",function(){this.popup.hide()}),this.listenTo(this,"tracksInserted",this.tracksInserted)},render:function(){var a=this;return this.template({},function(b,c){a.$el.html(c).append(a.popup.render().$el),a.$("#category-container").html(a.list.render().$el)}),this},unrender:function(){this.stopListening(),this.list.unrender()},tracksInserted:function(){this.model.fetch()}}),Wu.Views.categoryList=Wu.Views.list.extend({ORDER:["Artist","Album","Title"],infoTemplate:JST["category.info"],events:{"click .category-list li:not(.jumper)":"select","click .title":"showPopup"},initialize:function(a){Wu.Views.list.prototype.initialize.call(this,a),a.url?this.url=a.url:(this.url="category/",this.isCategory=!0),this.listenTo(this.model,"change:docs",this.render),this.isCategory&&(this.listenTo(Wu.Cache.Collections.servers,"add remove",function(){this.isCategory&&!Wu.Cache.Collections.servers.tracksInserted&&this.render()}),this.listenTo(Wu.Cache.Collections.servers,"change:tracksInserted",this.render))},render:function(){{var a=this;this.model.get("docs")}return!this.isCategory||Wu.Cache.Collections.servers.tracksInserted?(Wu.Views.list.prototype.render.call(this),$("#mask").hide(),this.trigger("rendered")):this.infoTemplate({servers:Wu.Cache.Collections.servers},function(b,c){a.$el.html(c),$("#mask").show()}),this},unrender:function(){Wu.Views.list.prototype.unrender.call(this),this.$el.off(),this.stopListening()},select:function(a){var b=this.model.filter($(a.target).text(),a.target.id);b?Backbone.history.navigate(this.url+b,{trigger:!0}):this.trigger("showPopup")},showPopup:function(a){a.preventDefault(),this.trigger("showPopup")}}),Wu.Views.categoriesNav=Backbone.View.extend({template:JST["category.nav"],initialize:function(){this.listenTo(this.model,"change:id",this.updateActive)},render:function(){var a=this;return this.template({},function(b,c){a.$el.html(c),a.updateActive({},a.model.get("id"))}),this},unrender:function(){this.stopListening()},updateActive:function(a,b){this.$(".active").removeClass("active"),this.$("."+b).addClass("active")}}),Wu.Views.categoryPopup=Backbone.View.extend({template:JST["category.popup"],events:{"click h1.play i":"playNow","click h1.play .next":"playNext","click h1.add":"showAddTo","click h1.new":"showCreate","click span.new":"showCreate","click .cancel":"back","submit .bottom-box.new form":"createList","click .bottom-box.add li":"addToList"},render:function(){var a=this;return this.template({},function(b,c){a.$el.html(c),a.setHeight()}),this},unrender:function(){var a=this.model.get("filter");a&&delete a._id,$("#mask").off("click",$.proxy(this.hide,this))},setHeight:function(){var a=$(window).height()-Math.round(.11*$(window).height())-100;a=Math.min(500,a),this.$(".bottom-box").css("max-height",a)},generateList:function(){if(this.collection.length){var a="<ul>";this.collection.each(function(b){a+="<li listId='"+b.get("_id")+"'>"+b.get("name")+"</li>"}),a+="</ul>"}else var a="No exisiting playlists, <span class='new'>create one</span> to continue";return a},showAddTo:function(){this.$el.addClass("add expand"),this.collection.fetch({success:$.proxy(function(){this.$(".bottom-box.add").html(this.generateList())},this)})},showCreate:function(){this.$el.removeClass("add").addClass("new expand"),this.$("input.name").val("")},back:function(){this.$el.hasClass("expand")?this.$el.removeClass("new add expand"):this.hide()},show:function(){$("#mask").show(),$("#mask").on("click",$.proxy(this.hide,this)),this.$el.show()},hide:function(){$("#mask").hide(),$("#mask").off("click",$.proxy(this.hide,this)),this.$el.hide(),this.$el.removeClass("new add expand");var a=this.model.get("filter");a&&delete a._id},createList:function(a){a.preventDefault();var b=this.$(".bottom-box.new .name")[0].value;if(""==b)alert("please enter a name");else{var c=new Wu.Models.playlist({name:b}),d=this.model.get("filter");c.set("filter",d),c.save(null,{success:$.proxy(function(a){var c='Playlist "'+b+'" created with '+a.get("added")+" tracks";this.collection.add(a),Wu.Cache.Views.toastMaster.message(c)},this),error:function(a,b){var c=b.responseText;Wu.Cache.Views.toastMaster.error(c)}}),c.set("filter",!1),this.hide()}},playNow:function(){var a=Wu.Cache.Models.player.get("quickList"),b=this.collection.get(a);return b?(b.set("clearAfter",0),this._add(b,function(){Socket.emit("playPlaylist",a)}),void 0):(Wu.Cache.Views.toastMaster.error("Must select a media renderer first"),void 0)},playNext:function(){var a=Wu.Cache.Models.player,b=a.get("quickList"),c=this.collection.get(b),d=a.get("currentPlayingTrack"),e=(a.get("playlist"),d?d.position:0);
return c?(c.set("clearAfter",e),this._add(c),void 0):(Wu.Cache.Views.toastMaster.error("Must select a media renderer first"),void 0)},addToList:function(a){var b=$(a.target).attr("listId"),c=this.collection.get(b);this._add(c)},_add:function(a,b){var c=this.model.get("filter");a.set("filter",c),a.save(null,{success:function(c){var d=c.get("added")+' tracks added to "'+a.get("name")+'" playlist';Wu.Cache.Views.toastMaster.message(d),"function"==typeof b&&b()},error:function(a,b){var c=b.responseText;Wu.Cache.Views.toastMaster.error(c)}}),a.unset("filter"),a.unset("clearAfter"),this.hide()}}),Wu.Views.directories=Backbone.View.extend({template:JST["directory.container"],events:{"click .popup .ok":"chooseDirectory","click .popup .cancel":"hidePrompt"},initialize:function(){this.list=new Wu.Views.categoryList({model:this.model,className:"category directory",url:"directory/",noJumper:!0,loader:!0,parent:this}),this.listenTo(this.model,"change:id",function(){this.model.fetch({error:function(a,b){Wu.Cache.Views.toastMaster.error(b.responseText),window.history.back()}})}),this.listenTo(this.list,"showPopup",this.showPrompt)},render:function(){var a=this;return this.template({},function(b,c){a.$el.html(c),a.$("#category-container").html(a.list.render().$el)}),this},unrender:function(){this.stopListening(),this.list.unrender()},showPrompt:function(){$("#mask").show(),this.$(".popup").show()},hidePrompt:function(){$("#mask").hide(),this.$(".popup").hide()},chooseDirectory:function(){var a,b=this.model.get("uuid"),c=this.model.get("id"),d=Wu.Cache.Collections.servers.get(b),e=this.model.getTitle();d&&(a=d.get("name"),d.save({path:c},{success:function(){Wu.Cache.Views.toastMaster.message('Adding tracks in "'+e+'" from "'+a+'"')},error:function(a){Wu.Cache.Views.toastMaster.error(a.responseText)}}),Backbone.history.navigate("/",{trigger:!0}))}}),Wu.Views.directoryMenu=Backbone.View.extend({template:JST["server.menu"],events:{"click .refresh":"reloadTracks"},initialize:function(){this.changeServer(),this.listenTo(this.model,"change:uuid",this.changeServer),this.listenTo(Wu.Cache.Collections.servers,"change:status",this.updateButtons)},render:function(){var a=this;return this.template({},function(b,c){a.$el.html(c)}),this},unrender:function(){this.stopListening()},changeServer:function(){var a=this.model.get("uuid");this.server=Wu.Cache.Collections.servers.get(a),this.updateButtons()},updateButtons:function(){var a=this.server&&this.server.get("status");a?"loading"===a?(this.$el.show(),this.$(".refresh").addClass("loading")):"inserted"===a&&(this.$el.show(),this.$(".refresh").removeClass("loading")):this.$el.hide()},reloadTracks:function(){if(this.server){var a=this.server.get("name");this.server.save({},{success:function(){Wu.Cache.Views.toastMaster.message("Refreshing track from "+a)},error:function(a){Wu.Cache.Views.toastMaster.error(a.responseText)}})}}}),Wu.Views.header=Backbone.View.extend({template:JST.header,events:{"click .menuLink":"toggleMenu"},initialize:function(){var a=this;this.template({},function(b,c){a.$el.html(c)})},render:function(){return this.subHeader&&this.subHeader.render(),this},unrender:function(){this.subHeader&&this.subHeader.unrender()},setSubHeader:function(a){this.subHeader&&this.subHeader.unrender(),this.subHeader=a,this.$("#subnav").html(this.subHeader.render().$el)},removeSubHeader:function(){this.subHeader&&(this.subHeader.unrender(),this.subHeader.remove())},toggleMenu:function(){this.trigger("menuClick")}}),Wu.Views.listJumper=Backbone.View.extend({events:{"click .back":"hide","click span.active":"jump"},initialize:function(a){this.$listEl=$(a.list),this.secret=Math.random()},render:function(){return this.$el.html(this.setupJumper()),this},unrender:function(){this.$el.off(),$("#mask").off("click",$.proxy(this.hide,this))},setupJumper:function(){for(var a,b="<div class='back icon-chevron-left'></div>",c=65;91>c;c++)a=String.fromCharCode(c),b+=this.$listEl.find("#jumper"+a).length>0?'<span class="active">'+a+"</span>":'<span class="greyed">'+a+"</span>";return b},jump:function(a){console.log(this.secret);var b=$(a.target).html();this.$listEl.find("#jumper"+b)[0].scrollIntoView(),this.hide()},show:function(){this.$el.addClass("flipOut"),$("#mask").on("click",$.proxy(this.hide,this)),$("#mask").show()},hide:function(){this.$el.removeClass("flipOut"),$("#mask").off("click",$.proxy(this.hide,this)),$("#mask").hide()}}),Wu.Views.menu=Backbone.View.extend({template:JST.menu,events:{"click .renderers li":"setRenderer","click .musicLink":"gotoMusic","click .playlists li .icon-trash":"deleteList"},initialize:function(){this.listenTo(Wu.Layout.header,"menuClick",this.show),this.listenTo(this.collection,"add remove reset",this.render),this.listenTo(Wu.Cache.Collections.servers,"add remove reset",this.render),this.listenTo(Wu.Cache.Collections.playlists,"add remove reset",this.render),this.listenTo(this,"hideMusic",this.hideMusic),this.listenTo(this,"showMusic",this.showMusic),this.listenTo(Wu.Cache.Models.player,"change:id",this.setActive),this.listenTo(Wu.Cache.Models.player,"change:playlist",this.setActive),this.listenTo(Wu.Cache.Models.player,"change:TransportState",this.setActive),this.listenTo(Wu.Cache.Collections.servers,"change:status",this.setStatus),this.$el.on("click","a",$.proxy(this.hide,this))},render:function(){var a=this;return this.template({playlists:Wu.Cache.Collections.playlists,renderers:this.collection,servers:Wu.Cache.Collections.servers},function(b,c){a.$el.html(c),a.showMusicLink&&a.showMusic(),a.setActive()}),this},unrender:function(){$("#mask").off("click",$.proxy(this.hide,this)),this.stopListening()},deleteList:function(a){var b=$(a.currentTarget).parent().attr("id"),c=Wu.Cache.Collections.playlists,d=c.get(b);d&&d.destroy()},show:function(){this.$el.removeClass("hide"),$("#mask").show().on("click",$.proxy(this.hide,this))},hide:function(){this.$el.addClass("hide"),$("#mask").hide().off("click",$.proxy(this.hide,this))},setRenderer:function(a){var b=$(a.currentTarget).attr("id");Wu.Cache.Models.player.setRenderer(b),this.hide()},hideMusic:function(){this.$(".musicLink").hide(),this.showMusicLink=!1},showMusic:function(){this.$(".musicLink").show(),this.showMusicLink=!0},gotoMusic:function(){var a=Wu.Cache.Models.category.get("id")||"Artist";this.hide(),Backbone.history.navigate("/category/"+a,{trigger:!0})},setStatus:function(a,b){$("#ms"+a.id).removeClass("loading").addClass(b)},setActive:function(){var a=Wu.Cache.Models.player.id,b=Wu.Cache.Models.player.get("playlist"),c="PLAYING"===Wu.Cache.Models.player.get("TransportState");this.$("li").removeClass("active"),b&&$("#"+b)[c?"addClass":"removeClass"]("active"),a&&$("#"+a).addClass("active")}}),Wu.Views.playerTab=Backbone.View.extend({template:JST["player.tab"],events:{"click .icon-play":"play","click .icon-pause":"pause","click .next":"next","mousedown .ball":"dragStart","touchstart .ball":"dragStart"},initialize:function(){this.listenTo(this.model,"change:currentPlayingTrack",this.changeTrack),this.listenTo(this.model,"change:TransportState",this.changePlayState),this.listenTo(this,"inserted",this.setupDrag),this.lastTime=Date.now(),this.animator=this.animateProgress.bind(this),this.animateProgress(),this.listenTo($(document),"mousemove touchmove",$.proxy(this.drag,this)),this.listenTo($(document),"mouseup touchend",$.proxy(this.dragEnd,this)),this.listenTo(this.$el,"mousedown",function(a){a.preventDefault()}),this.listenTo($(window),"resize",$.proxy(function(){this.width=this.$el.width()-50},this)),this.animate=!0},render:function(){var a=this;return this.template({model:this.model},function(b,c){a.$el.html(c),a.changeTrack(a.model,a.model.get("currentPlayingTrack")),a.changePlayState(a.model,a.model.get("TransportState")),a.setPosition(a.model.get("trackPosition"))}),this},unrender:function(){this.stopListening()},animateProgress:function(){if(this.animate&&!this.dragging&&"PLAYING"===this.model.get("TransportState")){var a=this.model.get("trackPosition");this.setPosition(a),this.model.set("trackPosition",a+Date.now()-this.lastTime)}this.lastTime=Date.now(),window.requestAnimationFrame(this.animator)},setPosition:function(a){var b=this.width*(a/this.model.get("duration"));this.$(".ball").css("-webkit-transform","translate3d("+b+"px,0,0)")},dragStart:function(a){this.dragging=!0,a.preventDefault()},drag:function(a){if(this.dragging){var b=a.pageX||a.touches[0].pageX;this.lastX=b,this.$(".ball").css("-webkit-transform","translateZ(0) translateX("+b+"px)")}},dragEnd:function(){if(this.dragging){var a=this.lastX/this.width*this.model.get("duration");Socket.emit("setPosition",a)}this.dragging=!1,this.animate=!1;var b=this;setTimeout(function(){b.animate=!0},1e3)},setupDrag:function(){var a=this;this.width=this.$el.width()-50,Drawer.init({el:this.$el}),this.$el.on("left",function(){a.$el.css("left","0%")}),this.$el.on("right",function(){a.dragging||a.$el.css("left","100%")})},play:function(){Socket.emit("play")},pause:function(){Socket.emit("pause")},next:function(){Socket.emit("next")},changeTrack:function(a,b){var c=b&&b.Title?b.Title:"Unknown";this.$(".title").html(c).attr("href","/playlist/"+a.get("playlist"))},changePlayState:function(a,b){"PLAYING"===b?(this.$(".ball").show(),this.$(".play").removeClass("icon-play").addClass("icon-pause")):(this.$(".ball")["PAUSED_PLAYBACK"===b?"show":"hide"](),this.$(".play").removeClass("icon-pause").addClass("icon-play"))}}),Wu.Views.playlistDropdown=Backbone.View.extend({template:JST["playlist.dropdown"],events:{"click .opened .current":"hide","click .current":"show"},render:function(){var a=this;return this.template({currentList:this.model,playlists:Wu.Cache.Collections.playlists},function(b,c){a.$el.html(c)}),this},unrender:function(){$("#mask").off("click",$.proxy(this.hide,this)),this.stopListening()},show:function(a){$("#mask").show(),$("#mask").on("click",$.proxy(this.hide,this)),this.$(".dropDown").addClass("opened"),this.$(".down").removeClass("icon-angle-down").addClass("icon-angle-up"),a.stopImmediatePropagation()},hide:function(a){$("#mask").hide(),$("#mask").off("click",$.proxy(this.hide,this)),this.$(".dropDown").removeClass("opened"),this.$(".down").removeClass("icon-angle-up").addClass("icon-angle-down"),a.stopImmediatePropagation()}}),Wu.Views.toastMaster=Backbone.View.extend({initialize:function(){this.listenTo(Wu.Cache.Collections.renderers,"add",function(a){this.message('New media renderer "'+a.get("name")+'" detected')},this),this.listenTo(Wu.Cache.Collections.renderers,"remove",function(a){this.message('Media renderer "'+a.get("name")+'" removed')},this),this.listenTo(Wu.Cache.Collections.servers,"add",function(a){this.message('New media server "'+a.get("name")+'" detected')},this),this.listenTo(Wu.Cache.Collections.servers,"remove",function(a){this.message('Media server "'+a.get("name")+'" removed')},this),this.listenTo(Wu.Cache.Models.player,"change:currentPlayingTrack",function(a,b){b&&this.title(b.Title)},this),this.listenTo(Wu.Cache.Models.player,"change:uuid",function(a,b){var c=Wu.Cache.Collections.renderers.get(b);c?this.message('Now playing to "'+c.get("name")+'" renderer'):this.message("No media renderer selected")},this),Socket.on("error",$.proxy(function(a){this.error(a)},this)),Socket.on("tracksInserted",$.proxy(function(){this.message("New tracks inserted")},this)),this.messageStack=[]},title:function(a){window.clearTimeout(this.titleTimeout),$("title").html(a),this.titleTimeout=window.setTimeout(function(){$("title").html("Wu")},4e3)},message:function(a){this.messageStack.push({text:a,type:"message"}),this._show()},error:function(a){this.messageStack.push({text:a,type:"error"}),this._show()},_add:function(a){this.messageStack.push(a),$(".toast").html(a),$(".toast-wrap").show(),window.setTimeout(function(){$(".toast-wrap").hide()},4e3)},_show:function(){if("none"===$(".toast-wrap").css("display")&&this.messageStack.length){var a=this.messageStack.shift();$(".toast-wrap")["error"===a.type?"addClass":"removeClass"]("error").show(),$(".toast").html(a.text),window.setTimeout($.proxy(function(){$(".toast-wrap").hide(),this._show()},this),4e3)}}}),Wu.Views.trackList=Backbone.View.extend({template:JST["track.list"],events:{"click .track-info":"play"},initialize:function(){this.listenTo(Wu.Cache.Models.player,"change:currentPlayingTrack",this.highlight),this.listenTo(this,"inserted",this.highlight),this.listenTo(this,"swipeAway",this.delete),Wu.Mixin.mix(this,Wu.Mixin.swipeAway)},render:function(){var a=this;return this.template({collection:this.collection},function(b,c){a.$el.html(c),a.$("li").length&&a.$("li")[0].scrollIntoView()}),this},unrender:function(){this.stopListening()},highlight:function(){var a=Wu.Cache.Models.player.get("currentPlayingTrack"),b=a?a._id:!1;this.$("li").removeClass("active"),$("#"+b).addClass("active")},play:function(a){if(!$(a.currentTarget).parent().hasClass("transition")){var b=$(a.currentTarget).parent().parent().attr("position");Wu.Cache.Models.player.playByPosition(b,this.model.get("_id"))}},"delete":function(a){var b=this.collection.get(a.attr("position"));b&&b.destroy({error:function(a,b){var c=b.responseText;Wu.Cache.Views.toastMaster.error(c)}})}}),Wu.Models.category=Backbone.Model.extend({ORDER:["Artist","Album","Title"],urlRoot:"/api/categories",initialize:function(){Socket.on("tracksInserted",function(){Wu.Layout.page.trigger("tracksInserted")})},fetch:function(a){var b=this.get("filter");a=a||{},a.data=_.extend({},a.data,{filter:b}),Backbone.Model.prototype.fetch.call(this,a)},filter:function(a,b){var c=this.get("filter")||{},d=this.get("id"),e=_.indexOf(this.ORDER,d);return e++,e<this.ORDER.length?(c[d]=a,this.set("filter",c)):"Title"===d&&(c._id=b),this.ORDER[e]},setCategory:function(a){var b=this.get("filter")||{},c=this.get("id"),d=_.indexOf(this.ORDER,c);for(newIndex=_.indexOf(this.ORDER,a);d>=newIndex;)b[this.ORDER[d]]&&delete b[this.ORDER[d]],d--;b._id&&delete b._id,this.set("filter",b),this.set("id",a)},getTitle:function(){for(var a=this.get("filter")||{},b=this.get("id"),c=_.indexOf(this.ORDER,b);--c>=0;)if(a[this.ORDER[c]])return a[this.ORDER[c]];return!1}}),Wu.Models.directory=Backbone.Model.extend({urlRoot:function(){return"/api/directory/"+this.get("uuid")+"/"},initialize:function(){this.titleMap={}},filter:function(a,b){return b?(this.titleMap[b]=a,this.get("uuid")+"/"+b):!1},getTitle:function(){return this.titleMap[this.get("id")]}}),Wu.Models.player=Backbone.Model.extend({urlRoot:"/api/renderers",idAttribute:"uuid",initialize:function(){var a=this;Socket.on("stateChange",function(b){a.set(b.name,b.value)}),Socket.on("setRendererResult",function(b,c){b?(Wu.Cache.Views.toastMaster.error(b),a.clear()):(a.set("uuid",c),a.fetch())}),Socket.on("rendererRemoved",function(b){a.get("uuid")===b.uuid&&a.clear()})},playByPosition:function(a,b){Socket.emit("playByPosition",a,b)},setRenderer:function(a){Socket.emit("setRenderer",a)}}),Wu.Models.playlist=Backbone.Model.extend({urlRoot:"/api/playlists",idAttribute:"_id"}),Wu.Models.renderer=Backbone.Model.extend({idAttribute:"uuid",urlRoot:"/api/renderers"}),Wu.Models.server=Backbone.Model.extend({idAttribute:"uuid",urlRoot:"/api/servers"}),Wu.Models.tracks=Backbone.Model.extend({idAttribute:"position"}),Wu.Collections.playlists=Backbone.Collection.extend({initialize:function(){Socket.on("rendererAdded",$.proxy(function(){this.fetch()},this)),Socket.on("rendererRemoved",$.proxy(function(){this.fetch()},this))},model:Wu.Models.playlist,url:"/api/playlists"}),Wu.Collections.renderers=Backbone.Collection.extend({model:Wu.Models.renderer,url:"/api/renderers",initialize:function(){var a=this;Socket.on("rendererAdded",function(b){a.add(b)}),Socket.on("rendererRemoved",function(b){var c=a.get(b.uuid);a.remove(c)})}}),Wu.Collections.servers=Backbone.Collection.extend({model:Wu.Models.server,url:"/api/servers",setTracks:function(a){this.tracksInserted!=a&&(this.tracksInserted=a,this.trigger("change:tracksInserted"))},initialize:function(){var a=this;Socket.on("serverAdded",function(b){"inserted"===b.status&&a.setTracks(!0),a.add(b)}),Socket.on("serverRemoved",function(b){a.remove(this.get(b.uuid))}),this.on("reset",function(){a.each(function(b){"inserted"===b.get("status")&&a.setTracks(!0)})}),Socket.on("tracksInserted",function(b){console.log("tracksInserted",b);var c=a.get(b);c&&c.set("status","inserted"),a.setTracks(!0)}),this.hasTracks=!1}}),Wu.Collections.tracks=Backbone.Collection.extend({model:Wu.Models.tracks,initialize:function(a){this._id=a.id},url:function(){return"/api/playlists/"+this._id}}),Wu.Routers.Categories=Backbone.Router.extend({routes:{"":"index","category/:id":"show","playlist/:id":"showList","directory/:uuid/:id":"showDir"},index:function(){this.show("Artist")},show:function(a){var b=Wu.Cache.Models.category;if(b.setCategory(a),"categories"!=Wu.Layout.state){var c=new Wu.Views.categoriesNav({model:b}),d=new Wu.Views.categories({model:b});Wu.Layout.menu.trigger("hideMusic"),b.fetch({success:function(){Wu.Layout.setSubHeader(c),Wu.Layout.setPage(d),Wu.Layout.state="categories"},error:function(){Wu.Cache.Views.toastMaster.error("failed to get category")}})}},showList:function(a){var b,c=Wu.Cache.Collections.playlists.get(a);c?(b=c.get("tracks")||c.set("tracks",new Wu.Collections.tracks({id:a})).get("tracks"),Wu.Layout.state="playlist",Wu.Layout.menu.trigger("showMusic"),b.fetch({success:function(){var a=new Wu.Views.playlistDropdown({model:c}),d=new Wu.Views.trackList({model:c,collection:b,className:"category"});Wu.Layout.setSubHeader(a),Wu.Layout.setPage(d)},error:function(a,b){Wu.Cache.Views.toastMaster.error(b.responseText)}})):Wu.Cache.Views.toastMaster.error("Playlist not found")},showDir:function(a,b){var c=Wu.Cache.Models.directory.get("uuid");if("directory"!=Wu.Layout.state){var d=new Wu.Views.directoryMenu({model:Wu.Cache.Models.directory}),e=new Wu.Views.directories({model:Wu.Cache.Models.directory});Wu.Layout.setSubHeader(d),Wu.Layout.setPage(e),Wu.Layout.state="directory"}Wu.Layout.menu.trigger("showMusic"),Wu.Cache.Models.directory.set("uuid",a),c!=a?(Wu.Cache.Models.directory.set({id:b},{silent:!0}),Wu.Cache.Models.directory.trigger("change:id")):Wu.Cache.Models.directory.set({id:b})}}),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Wu.Mixin={mix:function(a,b){for(var c,d="_mixin",e=0,f=[];a[d+e];)e++;b.mixID=d+e,a[d]=b,b.view=a,c=_.isFunction(b.events)?b.events():b.events||{},_.each(c,function(c,d){if(!_.isFunction(b[c]))return console.log(c+" is not a function"),void 0;var e=d.split(/\b/);a.$el.on(e[0],e.slice(1).join(""),$.proxy(b[c],b))}),_.extend(a.events,{},f)}},Wu.Mixin.swipeAway={touchable:"ontouchstart"in document.documentElement,events:function(){return map={},map=this.touchable?{"touchstart .swipeEl":"start","touchmove  .swipeEl":"move","touchend   .swipeEl":"end"}:{"mousedown .swipeEl":"start","mousemove .swipeEl":"move","mouseout  .swipeEl":"end","mouseup   .swipeEl":"end"},map["webkitTransitionEnd .swipeEl"]="transitionEnd",map["transitionend .swipeEl"]="transitionEnd",map["click .swipeEl h1"]="undo",map},position:function(a){return a.touches?a.touches[0].pageX:a.pageX},start:function(a){this.cover=$(a.currentTarget).find(".swipeCover"),$(a.currentTarget).hasClass("transition")||(this.active=!0,this.startX=this.position(a),this.pos=0,this.touchable||a.preventDefault())},move:function(a){if(this.active){var b=this.position(a);this.pos=Math.min(0,b-this.startX),(this.pos<-5||this.started)&&(this.cover.css("-webkit-transform","translate3d("+this.pos+"px,0,0)"),this.started=!0)}},end:function(){this.active&&this.started&&(this.pos<-40?(this.cover.parent().addClass("transition"),this.cover.css("-webkit-transform","translate3d(-"+this.cover.width()+"px,0,0)")):this.pos<0&&(this.cover.parent().addClass("transition"),this.cover.css("-webkit-transform","translate3d(0,0,0)"))),this.active=!1,this.started=!1},transitionEnd:function(a){-1!=a.propertyName.indexOf("transform")?"translate3d(0px, 0px, 0px)"===$(a.target).css(a.propertyName)?$(a.currentTarget).removeClass("transition"):$(a.currentTarget).css("opacity",0):"opacity"==a.propertyName&&($(a.currentTarget).parent().hide(),this.view.trigger("swipeAway",$(a.currentTarget).parent()))},undo:function(a){a.preventDefault(),$(a.currentTarget).parent().css("-webkit-transform","translate3d(0,0,0)").parent().removeClass("transition").css("opacity",1)}};