window.JST={"category.container":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/category.container.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="popup"></div>'),__.line=2,__.col=1,__.push('<div id="category-container"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.info":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/category.info.blade";try{with(__.locals)__.line=1,__.col=1,servers.length?(__.line=4,__.col=3,__.push('<div class="info no-tracks">No tracks selected, add tracks from a server:'),__.line=5,__.col=5,__.push('<ul class="playlists">'),__.line=6,__.col=7,servers.each(function(e){__.line=7,__.col=9;var t=e.id;__.line=8,__.col=9;var i=e.get("status");__.line=9,__.col=9,__.push("<li"),__.r.attrs({id:{v:t,e:1},"class":{v:i,e:1}},__),__.push(">"),__.line=10,__.col=11,__.push("<a"),__.r.attrs({href:{v:"/directory/"+t+"/0",e:1}},__),__.push(">"),__.line=11,__.col=13,__.push(__.r.escape(e.get("name"))+"</a>"),__.line=12,__.col=11,__.push('<div class="loading">'),__.line=13,__.col=13,__.push("[ loading"),__.line=14,__.col=13,__.push('<i class="icon-refresh icon-spin"></i>'),__.line=15,__.col=13,__.push("]</div></li>")}),__.push("</ul></div>")):(__.line=2,__.col=3,__.push('<div class="info no-server">No upnp media servers detected on the network, add a server to begin</div>'))}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.nav":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/category.nav.blade";try{with(__.locals)__.line=1,__.col=1,__.push("<nav>"),__.line=2,__.col=3,__.push('<a href="/category/Artist" class="active Artist" cat="Artist">Artists</a>'),__.line=3,__.col=3,__.push('<a href="/category/Album" cat="Album" class="Album">Albums</a>'),__.line=4,__.col=3,__.push('<a href="/category/Title" cat="Title" class="Title">Tracks</a></nav>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.popup":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/category.popup.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="top-box">'),__.line=2,__.col=3,__.push('<h1 class="play">'),__.line=3,__.col=5,__.push('<i class="icon-play-circle"></i>'),__.line=4,__.col=5,__.push('<span class="divider">| </span>'),__.line=5,__.col=5,__.push('<span class="next">Play Next</span></h1>'),__.line=6,__.col=3,__.push('<h1 class="add"> Add to playlist</h1>'),__.line=7,__.col=3,__.push('<h1 class="new"> Create new playlist</h1></div>'),__.line=8,__.col=1,__.push('<div class="bottom-box add"></div>'),__.line=9,__.col=1,__.push('<div class="bottom-box new">'),__.line=10,__.col=3,__.push("<form>"),__.line=11,__.col=5,__.push('<input type="text" class="name"/>'),__.line=12,__.col=5,__.push('<input type="submit" class="submit"/></form></div>'),__.line=13,__.col=1,__.push('<span class="cancel">cancel</span>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"category.show":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/category.show.blade";try{with(__.locals){__.line=1,__.col=1;var title=model.getTitle();__.line=2,__.col=1;var docs=model.get("docs");__.line=3,__.col=1;var name;__.line=5,__.col=1,title&&(__.line=6,__.col=3,__.push('<span class="title">'),__.line=7,__.col=5,__.push(__.r.escape(title)+"</span>"));var current=jumper&&docs&&docs.length>20?" ":String.fromCharCode(99999);__.line=9,__.col=1,__.push('<div class="category-list">'),__.line=10,__.col=3,__.push("<ul>"),__.line=11,__.col=5,__.r.foreach(__,docs,function(e){__.line=12,__.col=7,name=e.Title||e,__.line=13,__.col=7,name.toUpperCase()[0]>current&&(__.line=14,__.col=9,current=name.toUpperCase()[0],__.line=15,__.col=9,__.push('<li class="jumper"'),__.r.attrs({id:{v:"jumper"+current,e:1}},__),__.push("></li>")),__.line=17,__.col=7,e._id?(__.line=18,__.col=9,__.push("<li"),__.r.attrs({id:{v:e._id,e:1}},__),__.push(">"+__.r.escape(name)+"</li>")):(__.line=20,__.col=9,__.push("<li>"+__.r.escape(name)+"</li>"))}),__.push("</ul></div>")}}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"directory.container":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/directory.container.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="popup server">'),__.line=2,__.col=3,__.push("<h1>Add tracks from current directory?</h1>"),__.line=3,__.col=3,__.push('<h2 class="ok">ok</h2>'),__.line=4,__.col=3,__.push('<h2 class="cancel">cancel</h2></div>'),__.line=5,__.col=1,__.push('<div id="category-container"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},header:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/header.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="nav-wrap">'),__.line=2,__.col=3,__.push('<span class="menuLink icon-reorder"></span>'),__.line=3,__.col=3,__.push('<div id="subnav"></div></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},loader:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/loader.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="icon-spinner icon-spin loader"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},menu:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/menu.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="musicLink">'),__.line=2,__.col=3,__.push('<i class="icon-chevron-left"></i>'),__.line=3,__.col=3,__.push("Music </div>"),__.line=4,__.col=1,__.push('<div class="lists">'),__.line=5,__.col=3,__.push("<h1>Play To</h1>"),__.line=6,__.col=3,__.push('<ul class="renderers">'),__.line=7,__.col=5,renderers.each(function(e){__.line=8,__.col=7;var t=e.get("uuid");__.line=9,__.col=7,__.push("<li"),__.r.attrs({id:{v:t,e:1}},__),__.push(">"),__.line=10,__.col=9,__.push("<span>"),__.line=11,__.col=11,__.push(__.r.escape(e.get("name"))+"</span>"),__.line=12,__.col=9,__.push('<i class="icon-circle"></i></li>')}),__.push("</ul>"),__.line=14,__.col=3,__.push("<h1>Playlists</h1>"),__.line=15,__.col=3,__.push('<ul class="playlists">'),__.line=16,__.col=5,playlists.each(function(e){__.line=17,__.col=7;var t=e.get("_id");__.line=18,__.col=7,__.push("<li"),__.r.attrs({id:{v:t,e:1}},__),__.push(">"),__.line=19,__.col=9,__.push("<a"),__.r.attrs({href:{v:"/playlist/"+t,e:1}},__),__.push(">"),__.line=20,__.col=11,__.push(__.r.escape(e.get("name"))+"</a>"),__.line=21,__.col=9,__.push('<i class="icon-volume-up"></i></li>')}),__.push("</ul>"),__.line=23,__.col=3,__.push("<h1>Servers</h1>"),__.line=24,__.col=3,__.push('<ul class="playlists servers">'),__.line=25,__.col=5,servers.each(function(e){__.line=26,__.col=7;var t=e.id;__.line=27,__.col=7;var i=e.get("status");__.line=28,__.col=7,__.push("<li"),__.r.attrs({id:{v:"ms"+t,e:1},"class":{v:i,e:1}},__),__.push(">"),__.line=29,__.col=9,__.push("<a"),__.r.attrs({href:{v:"/directory/"+t+"/0",e:1}},__),__.push(">"),__.line=30,__.col=11,__.push(__.r.escape(e.get("name"))),__.line=31,__.col=11,__.push('<i class="icon-refresh icon-spin"></i></a></li>')}),__.push("</ul></div>")}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"player.tab":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/player.tab.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="playing">'),__.line=2,__.col=3,__.push('<a class="title">Now Playing</a>'),__.line=3,__.col=3,__.push('<i class="icon-play play"></i>'),__.line=4,__.col=3,__.push('<i class="icon-chevron-right next"></i>'),__.line=5,__.col=3,__.push('<div class="ball"></div></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"playlist.dropdown":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/playlist.dropdown.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<ul class="dropDown closed">'),__.line=2,__.col=3,__.push('<li class="current">'),__.line=3,__.col=5,__.push(__.r.escape(currentList.get("name"))),__.line=4,__.col=5,playlists.length>1&&(__.line=5,__.col=7,__.push('<i class="icon-angle-down down"></i>')),__.push("</li>"),__.line=6,__.col=3,playlists.each(function(e){__.line=7,__.col=5;var t=e.get("_id");__.line=8,__.col=5,t!==currentList.get("_id")&&(__.line=9,__.col=7,__.push('<li class="option">'),__.line=10,__.col=9,__.push("<a"),__.r.attrs({href:{v:"/playlist/"+t,e:1}},__),__.push(">"),__.line=11,__.col=11,__.push(__.r.escape(e.get("name"))+"</a>"+"</li>"))}),__.push("</ul>")}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},popup:function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/popup.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="top-box">'),__.line=2,__.col=3,__.push("<h1>add to now playing</h1>"),__.line=3,__.col=3,__.push("<h1>add to ...</h1>"),__.line=4,__.col=3,__.push("<h1>add to new list</h1>"),__.line=5,__.col=3,__.push("<span>cancel</span></div>"),__.line=6,__.col=1,__.push('<div class="bottom-box"></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"server.menu":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/server.menu.blade";try{with(__.locals)__.line=1,__.col=1,__.push('<div class="directory-button refresh">'),__.line=2,__.col=3,__.push('<div class="refresh">'),__.line=3,__.col=5,__.push("Refresh"),__.line=4,__.col=5,__.push('<i class="icon-refresh"></i></div>'),__.line=5,__.col=3,__.push('<div class="load">'),__.line=6,__.col=5,__.push("loading"),__.line=7,__.col=5,__.push('<i class="icon-refresh icon-spin"></i></div></div>')}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)},"track.list":function(locals,cb,__){__=__||[],__.r=__.r||blade.Runtime,__.func||(__.func={},__.blocks={},__.chunk={}),__.locals=locals||{},__.filename="/Users/spurcell/code/fun/node_modules/wu/templates/track.list.blade";try{with(__.locals){__.line=1,__.col=1;var docs=collection.toJSON();__.line=3,__.col=1,__.push('<div class="track-list">'),__.line=4,__.col=3,__.push("<ul>"),__.line=5,__.col=5,__.r.foreach(__,docs,function(e){__.line=6,__.col=7,__.push("<li"),__.r.attrs({id:{v:e._id,e:1},position:{v:e.position,e:1}},__),__.push(">"),__.line=7,__.col=9,__.push('<div class="swipeEl">'),__.line=8,__.col=11,__.push('<div class="track-info">'),__.line=9,__.col=13,__.push('<div class="track-title">'+__.r.escape(e.Title)+"</div>"),__.line=10,__.col=13,__.push('<div class="more">'),__.line=11,__.col=15,__.push(__.r.escape(e.Artist+" - "+e.Album)+"</div>"+"</div>"),__.line=12,__.col=11,__.push('<div class="swipeCover">'),__.line=13,__.col=13,__.push("<h1>Undo</h1></div></div></li>")}),__.push("</ul></div>")}}catch(e){return cb(__.r.rethrow(e,__))}__.inc||__.r.done(__),cb(null,__.join(""),__)}},Wu={Views:{},Models:{},Collections:{},Cache:{Models:{},Views:{},Collections:{}},Routers:{},init:function(){window.Socket=io.connect("/controller"),this.Cache.Models.category=new Wu.Models.category,this.Cache.Models.directory=new Wu.Models.directory,this.Cache.Models.player=new Wu.Models.player,this.Cache.Collections.renderers=new Wu.Collections.renderers,Wu.Cache.Categories=new Wu.Routers.Categories,Wu.Cache.Collections.playlists=new Wu.Collections.playlists,Wu.Cache.Collections.servers=new Wu.Collections.servers,Wu.Cache.Views.toastMaster=new Wu.Views.toastMaster,this.Cache.Collections.servers.reset(bootstrapServers),this.Cache.Collections.renderers.reset(bootstrapRenderers),this.Cache.Collections.playlists.reset(bootstrapPlaylists),$(document).on("click","a:not(.data-bypass)",function(e){e.preventDefault(),Backbone.history.navigate($(e.target).attr("href"),{trigger:!0})}),$(document).on("swipeRight",".category",function(){window.history.back()}),Wu.Layout.init(),Backbone.history.start({pushState:!0})}},$(document).ready(function(){window.Wu=Wu,Wu.init()});var Drawer=function(){function e(e){return e.touches?e.touches[0].pageY:e.pageY}function t(e){return e.touches?e.touches[0].pageX:e.pageX}function i(e){var t=e.touches?e.touches[0].pageX:e.pageX,i=e.touches?e.touches[0].pageY:e.pageY,s=t-c.offset().left,n=i-c.offset().top;b&&n>l&&o>n&&r>s&&s>a&&(d=e.timeStamp,h="horizontal"==u.drag?t:i,p=!0)}function s(e){if(p){e.preventDefault();var t=_(e),i=0===h?0:Math.abs(t-h),s=u.maxTime,n=u.maxDistance;if(currentTime=e.timeStamp,0!==d&&s>currentTime-d&&i>n){if(h>t){var o="horizontal"==u.drag?"left":"up";c.trigger(o)}if(t>h){var o="horizontal"==u.drag?"right":"down";c.trigger(o),p=!1}d=0,h=0}}else"full"==f?e.preventDefault():"partial"==f&&(e.overide||e.preventDefault())}function n(){d=0,h=0,p=!1}var o,r,l,a,c,_,u={maxTime:1e3,maxDistance:20,scopeEl:$("html"),xPadding:0,yPadding:0,drag:"horizontal"},h=0,d=0,p=!1,f=!1,m="ontouchend"in document,g=m?"touchstart":"mousedown",v=m?"touchmove":"mousemove",w=m?"touchend":"mouseup",b=!0;return{init:function(h){if($.extend(u,h),c=$(u.el),!c||1>c.length)throw"Error: Need to supply a valid target element";l=u.yPadding,a=u.xPadding,r=c.width()+a,o=c.height()+l,u.scopeEl.on(g,i).on(v,s).on(w,n),_="horizontal"==u.drag?t:e,$(".nots").bind(v,function(e){e.xyz=!0}),c.on("toggleDrag",function(e,t){b=void 0===t?!b:t})},toggle:function(e){p=e},lockScroll:function(e){f=e}}}();Wu.Layout={init:function(){this.header=new Wu.Views.header({el:$("#header")}),this.menu=new Wu.Views.menu({collection:Wu.Cache.Collections.renderers,el:$("#menu")}).render(),this.menu.trigger("inserted"),this.footer=new Wu.Views.playerTab({model:Wu.Cache.Models.player,el:$("#pullTab")}).render(),this.footer.trigger("inserted")},setSubHeader:function(e){this.header.setSubHeader(e),this.header.render()},removeSubHeader:function(){this.header.removeSubHeader()},setPage:function(e){this.page&&this.page.unrender(),this.menu.hide(),$("#mask").hide(),$("#page").html(e.render().$el),e.trigger("inserted"),this.page=e}},function(e){function t(e,t,i){function s(){var i=t.blocks;t.blocks={};var s=o.capture(t,t.length,e());return t.blocks=i,s}return i?s():u.isolate(s)}function i(e,t,i){i&&(e.filename=t.filename,e.source=t.source),e.line=t.line,e.col=t.col}function s(e,t,i){var s=e.buf.splice(i,e.buf.length-i);Array.prototype.unshift.apply(e.buf,s);for(var n in t.blocks)t.blocks[n].parent==e&&t.blocks[n].pos>=i&&(t.blocks[n].pos-=i)}function n(e,t){for(var i=e+" ",s=0;t-i.length+1>s;s++)i=" "+i;return i}var o="object"==typeof exports?exports:{},r={},l={},a=function(e,t){return t},c=function(e){return e()},_=function(e,t){return t()},u={attachEvents:a,setDataContext:a,isolate:c,render:c,list:function(e,t,i){var s=[];if(e.observe({added:function(e){s.push(e)}}).stop(),!s.length)return i();for(var n="",o=0;s.length>o;o++)n+=t(s[o]);return n},labelBranch:_,createLandmark:_,finalize:a};o.options={mount:"/views/",loadTimeout:15e3},(o.client="undefined"!=typeof window)&&(window.blade={Runtime:o,LiveUpdate:u,_cachedViews:r,_cb:{},runtime:o}),o.escape=function(e){return null==e?"":new String(e).replace(/&(?!([a-zA-Z]+|(#[0-9]+)|(#[xX][0-9a-fA-F]+));)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},o.attrs=function(e,t){for(var i in e){var s=e[i];if(null==s.v||s.v===!1){if(null==s.a)continue;s.v=s.a,delete s.a}s.v===!0&&(s.v=i),"class"==i&&(s.v instanceof Array&&(s.v=s.v.join(" ")),s.a&&(s.v=(s.v.length>0?s.v+" ":"")+s.a)),s.e?t.push(" "+i+'="'+o.escape(s.v)+'"'):t.push(" "+i+'="'+s.v+'"')}},o.ueid=o.client?1e3:0,o.bind=function(e,t,i,s,n){for(var o="",r=e.split(" "),a=0;r.length>a;a++)o=","+r[a]+" #"+t;l[o.substr(1)]=i;var c="i["+JSON.stringify(e)+"]="+(""+i);if(n){var a=s.length-1;s[a]=s[a].substr(0,s[a].length-3)+";"+c+"-->"}else s.push("<!--"+c+"-->")},o.trigger=e,o.loadTemplate=function(e,t,i,s){function n(e,i){for(var s=0;e.length>s;s++)i?e[s](i):e[s](null,r[t])}function l(e){var i=a._cb[t].cb;delete a._cb[t],c.parentNode.removeChild(c),n(i,Error("Blade Template ["+t+"] could not be loaded: "+(e?e:"Request timed out")))}if("function"==typeof i&&(s=i,"object"==typeof t?(i=t,t=e,e=""):i=null),"function"==typeof t&&(s=t,t=e,i=null,e=""),0>t.split("/").pop().indexOf(".")&&(t+=".blade"),o.client){if(t=o.resolve(t),r[t])return s(null,r[t]),!0;var a=window.blade;if(a._cb[t])a._cb[t].cb.push(s);else{var c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src=o.options.mount+t;var _=setTimeout(l,o.options.loadTimeout),u=a._cb[t]=function(s,r){if(clearTimeout(_),delete a._cb[t],c.parentNode.removeChild(c),r.length>0)for(var l=0,h=0;r.length>h;h++)o.loadTemplate(e,s+"/"+r[h],i,function(e){return e?n(u.cb,e):(++l==r.length&&n(u.cb),void 0)});else n(u.cb)};u.cb=[s];var h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(c,h),c.onload=c.onreadystatechange=c.onerror=function(){var e=this.readyState;e&&"loaded"!=e&&"complete"!=e||!a._cb[t]||(clearTimeout(_),l("Request failed"))}}return!1}return i.synchronous=!0,require("./blade").compileFile(e+"/"+t,i,function(e,t){return e?s(e):(s(null,t.template),void 0)}),!0},o.resolve=function(e){if(o.client){var t=document.createElement("div");t.innerHTML='<a href="'+o.escape("./"+e)+'"></a>',t=t.firstChild.href;var i=window.location.href.split("#")[0];return t=t.substr(i.substr(0,i.lastIndexOf("/")).length).replace(/\/[\/]+/g,"/"),"/"==t.charAt(0)&&(t=t.substr(1)),t}},o.include=function(e,t){var i=t.inc,s=t.base,n=t.rel,r=t.filename,l=t.line,a=t.col,c=t.source,_=t.locals;if(t.inc=!0,arguments.length>2){t.locals={};for(var h=2;arguments.length>h;h+=2)t.locals[arguments[h]]=arguments[h+1]}var d=o.loadTemplate(t.base,t.rel+"/"+e,o.compileOptions,function(h,d){if(h)throw h;var p=t.length;d(t.locals,function(h,d){if(h)throw h;t.inc=i,t.base=s,t.rel=n,t.filename=r,t.line=l,t.col=a,t.source=c,t.locals=_,t.bd||(d=o.capture(t,p),t.push(u.labelBranch(t.filename+":"+t.line+":inc:"+e,function(){return d})))},t)});if(!d)throw Error("Included file ["+t.rel+"/"+e+"] could not be loaded synchronously!")},o.func=function(e,t,i){var s=i.func[e]=t;s.filename=i.filename,s.source=i.source},o.call=function(e,t,i){var s=i.func[e],n=[i];if(null==s)throw Error("Function '"+e+"' is undefined.");for(var o=3;arguments.length>o;o++)n[o-2]=arguments[o];var r=i.filename,l=i.source;i.filename=s.filename,i.source=s.source,s.apply(t,n),i.filename=r,i.source=l},o.capture=function(e,t){for(var i in e.blocks){var s=e.blocks[i];s.pos>=t&&(!e.block||s.parent==e.block)&&(null==s.parent?e[s.pos]=s.buf.join(""):(s.parent.buf[s.pos]=s.buf.join(""),s.parent.numChildren--),delete e.blocks[i])}return e.splice(t,e.length-t).join("")},o.chunk=function(e,t,i){i.chunk[e]=function(){return o.capture(i,i.length,t.apply(this,arguments))}},o.isolate=function(e,i){i.push(t(e,i))},o.constant=function(e,t,i){i.push(u.labelBranch(i.filename+":"+e,function(){return u.createLandmark({constant:!0},function(){return o.capture(i,i.length,t())})}))},o.preserve=function(e,t,i,s){s.push(u.labelBranch(s.filename+":"+e,function(){return u.createLandmark({preserve:t},function(){return o.capture(s,s.length,i())})}))},o.foreach=function(e,i,s,n){function o(i){var n=i._id||("string"==typeof i?i:null)||u.UNIQUE_LABEL;return u.labelBranch(n,function(){return t(function(){return s.call(i,i)},e,l)})}function r(){return u.labelBranch("else",function(){return n?t(n,e,l):""})}var l=!1;if(i&&"observe"in i)e.push(u.list(i,o,r));else{l=!0;var a="",c=1;for(var _ in i)c=0,a+=o(i[_]);e.push(c?r():a)}},o.blockDef=function(e,t,s){var n=t.blocks[e]={parent:t.block||null,buf:[],pos:t.length,numChildren:0},o=["r","blocks","func","locals","cb","base","rel","filename","source"];for(var r in o)n.buf[o[r]]=t[o[r]];if(n.buf.block=n,n.parent&&n.parent.numChildren++,t.push(""),s.length>1)n.paramBlock=s;else try{s(n.buf)}catch(l){throw i(t,n.buf),l}},o.blockRender=function(e,t,n){var o=n.blocks[t];if(null==o)throw Error("Block '"+t+"' is undefined.");if(null==o.paramBlock)throw Error("Block '"+t+"' is a regular, non-parameterized block, which cannot be rendered.");for(var r=[o.buf],l=3;arguments.length>l;l++)r[l-2]=arguments[l];"r"==e&&(o.buf.length=0);var a=o.buf.length;try{o.paramBlock.apply(this,r)}catch(c){throw i(n,o.buf,1),c}"p"==e&&s(o,n,a)},o.blockMod=function(e,t,n,o){var r=n.blocks[t];if(null==r)throw Error("Block '"+t+"' is undefined.");"r"==e&&(delete r.paramBlock,r.buf.length=0);var l=r.buf.length;if(o.length>1)r.paramBlock=o;else try{r.buf.rel=n.rel,r.buf.base=n.base,o(r.buf)}catch(a){throw i(n,r.buf),a}"p"==e&&s(r,n,l)},o.done=function(e){for(var t=!1;!t;){t=!0;for(var i in e.blocks){var s=e.blocks[i];s.done||0!=s.numChildren||(t=!1,null==s.parent?e[s.pos]=s.buf.join(""):(s.parent.buf[s.pos]=s.buf.join(""),s.parent.numChildren--),s.done=!0)}}e.eventHandlers=l,l={},o.client||(o.ueid=0)},o.rethrow=function(e,t){if(null==t&&(t=e),e.lastFilename==t.filename&&null!=e.lastFilename)return e;t.column=t.column||t.col;var i=e.message+"\n    at "+(null==t.filename?"<anonymous>":t.filename)+(null==t.line?"":":"+t.line+(null==t.column?"":":"+t.column));if(null!=t.source){var s=3,o=t.source.split("\n"),r=Math.max(t.line-s,0),l=Math.min(t.line+s,o.length),a=new String(l).length;o=o.slice(r,l),i+="\n\n";for(var c=0;o.length>c;c++)i+=n(c+r+1,a)+(c+r+1==t.line?">	":"|	")+o[c]+"\n"}return e.message=i,e.lastFilename=t.filename,null==e.filename&&null==e.line&&(e.filename=t.filename,e.line=t.line,e.column=t.column),e}}(function(e,t){var r=e.previousSibling,i={},h,n;eval(r.textContent),e.parentNode.removeChild(r);for(r in i)for(h=r.split(" "),n=0;h.length>n;n++)e["on"+h[n]]=i[r];return e["on"+t[0].type].apply(e,t)}),function(e){function t(e){return"tagName"in e?e:e.parentNode}function i(e,t,i,s){var n=Math.abs(e-t),o=Math.abs(i-s);return n>=o?e-t>0?"Left":"Right":i-s>0?"Up":"Down"}function s(){c=null,_.last&&(_.el.trigger("longTap"),_={})}function n(){c&&clearTimeout(c),c=null}function o(){r&&clearTimeout(r),l&&clearTimeout(l),a&&clearTimeout(a),c&&clearTimeout(c),r=l=a=c=null,_={}}var r,l,a,c,_={},u=750;e(document).ready(function(){var h,d;e(document.body).bind("touchstart",function(i){h=Date.now(),d=h-(_.last||h),_.el=e(t(i.touches[0].target)),r&&clearTimeout(r),_.x1=i.touches[0].pageX,_.y1=i.touches[0].pageY,d>0&&250>=d&&(_.isDoubleTap=!0),_.last=h,c=setTimeout(s,u)}).bind("touchmove",function(e){n(),_.x2=e.touches[0].pageX,_.y2=e.touches[0].pageY,Math.abs(_.x1-_.x2)>10&&e.preventDefault()}).bind("touchend",function(){n(),_.x2&&Math.abs(_.x1-_.x2)>30||_.y2&&Math.abs(_.y1-_.y2)>30?a=setTimeout(function(){_.el.trigger("swipe"),_.el.trigger("swipe"+i(_.x1,_.x2,_.y1,_.y2)),_={}},0):"last"in _&&(l=setTimeout(function(){var t=e.Event("tap");t.cancelTouch=o,_.el.trigger(t),_.isDoubleTap?(_.el.trigger("doubleTap"),_={}):r=setTimeout(function(){r=null,_.el.trigger("singleTap"),_={}},250)},0))}).bind("touchcancel",o),e(window).bind("scroll",o)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}(Zepto),Wu.Views.list=Backbone.View.extend({template:JST["category.show"],initialize:function(e){if(e&&e.noJumper||(this.jumper=new Wu.Views.listJumper({list:this.$el,el:$("#alphabet")}),this.$el.on("click",".jumper",$.proxy(this.jumper.show,this.jumper))),e&&e.loader){var t=this;JST.loader({},function(e,i){t.loaderHTML=i}),this.listenTo(this.model,"request",function(){this.$(".loader").show(),$("#mask").show()})}},render:function(){var e=this;return this.template({model:this.model,jumper:this.jumper},function(t,i){$("#mask").hide(),e.$el.html(i),e.jumper&&e.jumper.render(),e.loaderHTML&&e.$el.append(e.loaderHTML);var s=e.$(".title")[0]||e.$("li")[0];s&&s.scrollIntoView()}),this},unrender:function(){this.stopListening(),this.jumper&&this.jumper.unrender()}}),Wu.Views.categories=Backbone.View.extend({template:JST["category.container"],initialize:function(){this.list=new Wu.Views.categoryList({model:this.model,className:"category",parent:this}),this.popup=new Wu.Views.categoryPopup({collection:Wu.Cache.Collections.playlists,model:this.model,className:"popup"}),this.listenTo(this.model,"change:id",function(){this.model.fetch()}),this.listenTo(this.list,"showPopup",function(){this.popup.show()}),this.listenTo(this.list,"rendered",function(){this.popup.hide()}),this.listenTo(this,"tracksInserted",this.tracksInserted)},render:function(){var e=this;return this.template({},function(t,i){e.$el.html(i).append(e.popup.render().$el),e.$("#category-container").html(e.list.render().$el)}),this},unrender:function(){this.stopListening(),this.list.unrender()},tracksInserted:function(){this.model.fetch()}}),Wu.Views.categoryList=Wu.Views.list.extend({ORDER:["Artist","Album","Title"],infoTemplate:JST["category.info"],events:{"click .category-list li:not(.jumper)":"select","click .title":"showPopup"},initialize:function(e){Wu.Views.list.prototype.initialize.call(this,e),e.url?this.url=e.url:(this.url="category/",this.isCategory=!0),this.listenTo(this.model,"change:docs",this.render),this.isCategory&&(this.listenTo(Wu.Cache.Collections.servers,"add remove",function(){this.isCategory&&!Wu.Cache.Collections.servers.tracksInserted&&this.render()}),this.listenTo(Wu.Cache.Collections.servers,"change:tracksInserted",this.render))},render:function(){var e=this;return this.model.get("docs"),!this.isCategory||Wu.Cache.Collections.servers.tracksInserted?(Wu.Views.list.prototype.render.call(this),$("#mask").hide(),this.trigger("rendered")):this.infoTemplate({servers:Wu.Cache.Collections.servers},function(t,i){e.$el.html(i),$("#mask").show()}),this},unrender:function(){Wu.Views.list.prototype.unrender.call(this),this.$el.off(),this.stopListening()},select:function(e){var t=this.model.filter($(e.target).text(),e.target.id);t?Backbone.history.navigate(this.url+t,{trigger:!0}):this.trigger("showPopup")},showPopup:function(e){e.preventDefault(),this.trigger("showPopup")}}),Wu.Views.categoriesNav=Backbone.View.extend({template:JST["category.nav"],initialize:function(){this.listenTo(this.model,"change:id",this.updateActive)},render:function(){var e=this;return this.template({},function(t,i){e.$el.html(i),e.updateActive({},e.model.get("id"))}),this},unrender:function(){this.stopListening()},updateActive:function(e,t){this.$(".active").removeClass("active"),this.$("."+t).addClass("active")}}),Wu.Views.categoryPopup=Backbone.View.extend({template:JST["category.popup"],events:{"click h1.play i":"playNow","click h1.play .next":"playNext","click h1.add":"showAddTo","click h1.new":"showCreate","click span.new":"showCreate","click .cancel":"back","submit .bottom-box.new form":"createList","click .bottom-box.add li":"addToList"},render:function(){var e=this;return this.template({},function(t,i){e.$el.html(i),e.setHeight()}),this},unrender:function(){var e=this.model.get("filter");e&&delete e._id,$("#mask").off("click",$.proxy(this.hide,this))},setHeight:function(){var e=$(window).height()-Math.round(.11*$(window).height())-100;e=Math.min(500,e),this.$(".bottom-box").css("max-height",e)},generateList:function(){if(this.collection.length){var e="<ul>";this.collection.each(function(t){e+="<li listId='"+t.get("_id")+"'>"+t.get("name")+"</li>"}),e+="</ul>"}else var e="No exisiting playlists, <span class='new'>create one</span> to continue";return e},showAddTo:function(){this.$el.addClass("add expand"),this.collection.fetch({success:$.proxy(function(){this.$(".bottom-box.add").html(this.generateList())},this)})},showCreate:function(){this.$el.removeClass("add").addClass("new expand"),this.$("input.name").val("")},back:function(){this.$el.hasClass("expand")?this.$el.removeClass("new add expand"):this.hide()},show:function(){$("#mask").show(),$("#mask").on("click",$.proxy(this.hide,this)),this.$el.show()},hide:function(){$("#mask").hide(),$("#mask").off("click",$.proxy(this.hide,this)),this.$el.hide(),this.$el.removeClass("new add expand");var e=this.model.get("filter");e&&delete e._id},createList:function(e){e.preventDefault();var t=this.$(".bottom-box.new .name")[0].value;if(""==t)alert("please enter a name");else{var i=new Wu.Models.playlist({name:t}),s=this.model.get("filter");i.set("filter",s),i.save(null,{success:$.proxy(function(e){var i='Playlist "'+t+'" created with '+e.get("added")+" tracks";this.collection.add(e),Wu.Cache.Views.toastMaster.message(i)},this),error:function(e,t){var i=t.responseText;Wu.Cache.Views.toastMaster.error(i)}}),i.set("filter",!1),this.hide()}},playNow:function(){var e=Wu.Cache.Models.player.get("quickList"),t=this.collection.get(e);return t?(t.set("clearAfter",0),this._add(t,function(){Socket.emit("playPlaylist",e)}),void 0):(Wu.Cache.Views.toastMaster.error("Must select a media renderer first"),void 0)},playNext:function(){var e=Wu.Cache.Models.player,t=e.get("quickList"),i=this.collection.get(t),s=e.get("currentPlayingTrack"),n=(e.get("playlist"),s?s.position:0);return i?(i.set("clearAfter",n),this._add(i),void 0):(Wu.Cache.Views.toastMaster.error("Must select a media renderer first"),void 0)},addToList:function(e){var t=$(e.target).attr("listId"),i=this.collection.get(t);this._add(i)},_add:function(e,t){var i=this.model.get("filter");e.set("filter",i),e.save(null,{success:function(i){var s=i.get("added")+' tracks added to "'+e.get("name")+'" playlist';Wu.Cache.Views.toastMaster.message(s),"function"==typeof t&&t()},error:function(e,t){var i=t.responseText;Wu.Cache.Views.toastMaster.error(i)}}),e.unset("filter"),e.unset("clearAfter"),this.hide()}}),Wu.Views.directories=Backbone.View.extend({template:JST["directory.container"],events:{"click .popup .ok":"chooseDirectory","click .popup .cancel":"hidePrompt"},initialize:function(){this.list=new Wu.Views.categoryList({model:this.model,className:"category directory",url:"directory/",noJumper:!0,loader:!0,parent:this}),this.listenTo(this.model,"change:id",function(){this.model.fetch({error:function(e,t){Wu.Cache.Views.toastMaster.error(t.responseText),window.history.back()}})}),this.listenTo(this.list,"showPopup",this.showPrompt)},render:function(){var e=this;return this.template({},function(t,i){e.$el.html(i),e.$("#category-container").html(e.list.render().$el)}),this},unrender:function(){this.stopListening(),this.list.unrender()},showPrompt:function(){$("#mask").show(),this.$(".popup").show()},hidePrompt:function(){$("#mask").hide(),this.$(".popup").hide()},chooseDirectory:function(){var e,t=this.model.get("uuid"),i=this.model.get("id"),s=Wu.Cache.Collections.servers.get(t),n=this.model.getTitle();
s&&(e=s.get("name"),s.save({path:i},{success:function(){Wu.Cache.Views.toastMaster.message('Adding tracks in "'+n+'" from "'+e+'"')},error:function(e){Wu.Cache.Views.toastMaster.error(e.responseText)}}),Backbone.history.navigate("/",{trigger:!0}))}}),Wu.Views.directoryMenu=Backbone.View.extend({template:JST["server.menu"],events:{"click .refresh":"reloadTracks"},initialize:function(){this.changeServer(),this.listenTo(this.model,"change:uuid",this.changeServer),this.listenTo(Wu.Cache.Collections.servers,"change:status",this.updateButtons)},render:function(){var e=this;return this.template({},function(t,i){e.$el.html(i)}),this},unrender:function(){this.stopListening()},changeServer:function(){var e=this.model.get("uuid");this.server=Wu.Cache.Collections.servers.get(e),this.updateButtons()},updateButtons:function(){var e=this.server&&this.server.get("status");e?"loading"===e?(this.$el.show(),this.$(".refresh").addClass("loading")):"inserted"===e&&(this.$el.show(),this.$(".refresh").removeClass("loading")):this.$el.hide()},reloadTracks:function(){if(this.server){var e=this.server.get("name");this.server.save({},{success:function(){Wu.Cache.Views.toastMaster.message("Refreshing track from "+e)},error:function(e){Wu.Cache.Views.toastMaster.error(e.responseText)}})}}}),Wu.Views.header=Backbone.View.extend({template:JST.header,events:{"click .menuLink":"toggleMenu"},initialize:function(){var e=this;this.template({},function(t,i){e.$el.html(i)})},render:function(){return this.subHeader&&this.subHeader.render(),this},unrender:function(){this.subHeader&&this.subHeader.unrender()},setSubHeader:function(e){this.subHeader&&this.subHeader.unrender(),this.subHeader=e,this.$("#subnav").html(this.subHeader.render().$el)},removeSubHeader:function(){this.subHeader&&(this.subHeader.unrender(),this.subHeader.remove())},toggleMenu:function(){this.trigger("menuClick")}}),Wu.Views.listJumper=Backbone.View.extend({events:{"click .back":"hide","click span.active":"jump"},initialize:function(e){this.$listEl=$(e.list),this.secret=Math.random()},render:function(){return this.$el.html(this.setupJumper()),this},unrender:function(){this.$el.off(),$("#mask").off("click",$.proxy(this.hide,this))},setupJumper:function(){for(var e,t="<div class='back icon-chevron-left'></div>",i=65;91>i;i++)e=String.fromCharCode(i),t+=this.$listEl.find("#jumper"+e).length>0?'<span class="active">'+e+"</span>":'<span class="greyed">'+e+"</span>";return t},jump:function(e){console.log(this.secret);var t=$(e.target).html();this.$listEl.find("#jumper"+t)[0].scrollIntoView(),this.hide()},show:function(){this.$el.addClass("flipOut"),$("#mask").on("click",$.proxy(this.hide,this)),$("#mask").show()},hide:function(){this.$el.removeClass("flipOut"),$("#mask").off("click",$.proxy(this.hide,this)),$("#mask").hide()}}),Wu.Views.menu=Backbone.View.extend({template:JST.menu,events:{"click .renderers li":"setRenderer","click .musicLink":"gotoMusic"},initialize:function(){this.listenTo(Wu.Layout.header,"menuClick",this.show),this.listenTo(this.collection,"add remove reset",this.render),this.listenTo(Wu.Cache.Collections.servers,"add remove reset",this.render),this.listenTo(Wu.Cache.Collections.playlists,"add remove reset",this.render),this.listenTo(this,"hideMusic",this.hideMusic),this.listenTo(this,"showMusic",this.showMusic),this.listenTo(this,"inserted",this.setupDrag),this.listenTo(Wu.Cache.Models.player,"change:id",this.setActive),this.listenTo(Wu.Cache.Models.player,"change:playlist",this.setActive),this.listenTo(Wu.Cache.Models.player,"change:TransportState",this.setActive),this.listenTo(Wu.Cache.Collections.servers,"change:status",this.setStatus),this.$el.on("click","a",$.proxy(this.hide,this))},render:function(){var e=this;return this.template({playlists:Wu.Cache.Collections.playlists,renderers:this.collection,servers:Wu.Cache.Collections.servers},function(t,i){e.$el.html(i),e.showMusicLink&&e.showMusic(),e.setActive()}),this},unrender:function(){$("#mask").off("click",$.proxy(this.hide,this)),this.stopListening()},setupDrag:function(){var e=this;Drawer.init({el:this.$el}),this.$el.on("left",function(){e.$el.css("left","-100%")}),this.$el.on("right",function(){e.$el.css("left","0%")})},show:function(){this.$el.removeClass("hide"),$("#mask").show().on("click",$.proxy(this.hide,this))},hide:function(){this.$el.addClass("hide"),$("#mask").hide().off("click",$.proxy(this.hide,this))},setRenderer:function(e){var t=$(e.currentTarget).attr("id");Wu.Cache.Models.player.setRenderer(t),this.hide()},hideMusic:function(){this.$(".musicLink").hide(),this.showMusicLink=!1},showMusic:function(){this.$(".musicLink").show(),this.showMusicLink=!0},gotoMusic:function(){var e=Wu.Cache.Models.category.get("id")||"Artist";this.hide(),Backbone.history.navigate("/category/"+e,{trigger:!0})},setStatus:function(e,t){$("#ms"+e.id).removeClass("loading").addClass(t)},setActive:function(){var e=Wu.Cache.Models.player.id,t=Wu.Cache.Models.player.get("playlist"),i="PLAYING"===Wu.Cache.Models.player.get("TransportState");this.$("li").removeClass("active"),t&&$("#"+t)[i?"addClass":"removeClass"]("active"),e&&$("#"+e).addClass("active")}}),Wu.Views.playerTab=Backbone.View.extend({template:JST["player.tab"],events:{"click .icon-play":"play","click .icon-pause":"pause","click .next":"next","mousedown .ball":"dragStart","touchstart .ball":"dragStart"},initialize:function(){this.listenTo(this.model,"change:currentPlayingTrack",this.changeTrack),this.listenTo(this.model,"change:TransportState",this.changePlayState),this.listenTo(this,"inserted",this.setupDrag),this.lastTime=Date.now(),this.animator=this.animateProgress.bind(this),this.animateProgress(),this.listenTo($(document),"mousemove touchmove",$.proxy(this.drag,this)),this.listenTo($(document),"mouseup touchend",$.proxy(this.dragEnd,this)),this.listenTo(this.$el,"mousedown",function(e){e.preventDefault()}),this.listenTo($(window),"resize",$.proxy(function(){this.width=this.$el.width()-50},this)),this.animate=!0},render:function(){var e=this;return this.template({model:this.model},function(t,i){e.$el.html(i),e.changeTrack(e.model,e.model.get("currentPlayingTrack")),e.changePlayState(e.model,e.model.get("TransportState")),e.setPosition(e.model.get("trackPosition"))}),this},unrender:function(){this.stopListening()},animateProgress:function(){if(this.animate&&!this.dragging&&"PLAYING"===this.model.get("TransportState")){var e=this.model.get("trackPosition");this.setPosition(e),this.model.set("trackPosition",e+Date.now()-this.lastTime)}this.lastTime=Date.now(),window.requestAnimationFrame(this.animator)},setPosition:function(e){var t=this.width*(e/this.model.get("duration"));this.$(".ball").css("-webkit-transform","translate3d("+t+"px,0,0)")},dragStart:function(e){this.dragging=!0,e.preventDefault()},drag:function(e){if(this.dragging){var t=e.pageX||e.touches[0].pageX;this.lastX=t,this.$(".ball").css("-webkit-transform","translateZ(0) translateX("+t+"px)")}},dragEnd:function(){if(this.dragging){var e=this.lastX/this.width*this.model.get("duration");Socket.emit("setPosition",e)}this.dragging=!1,this.animate=!1;var t=this;setTimeout(function(){t.animate=!0},1e3)},setupDrag:function(){var e=this;this.width=this.$el.width()-50,Drawer.init({el:this.$el}),this.$el.on("left",function(){e.$el.css("left","0%")}),this.$el.on("right",function(){e.dragging||e.$el.css("left","100%")})},play:function(){Socket.emit("play")},pause:function(){Socket.emit("pause")},next:function(){Socket.emit("next")},changeTrack:function(e,t){var i=t&&t.Title?t.Title:"Unknown";if(this.$(".title").html(i).attr("href","/playlist/"+e.get("playlist")),t){var s=new DOMParser,n=s.parseFromString(t.Didl,"text/xml"),o=n.getElementsByTagName("albumArtURI")[0];if(o){var r=o.childNodes[0].nodeValue;r!=this.albumArt&&($("body").css("background-image","url("+r+")"),this.albumArt=r)}}},changePlayState:function(e,t){"PLAYING"===t?(this.$(".ball").show(),this.$(".play").removeClass("icon-play").addClass("icon-pause")):(this.$(".ball")["PAUSED_PLAYBACK"===t?"show":"hide"](),this.$(".play").removeClass("icon-pause").addClass("icon-play"))}}),Wu.Views.playlistDropdown=Backbone.View.extend({template:JST["playlist.dropdown"],events:{"click .opened .current":"hide","click .current":"show"},render:function(){var e=this;return this.template({currentList:this.model,playlists:Wu.Cache.Collections.playlists},function(t,i){e.$el.html(i)}),this},unrender:function(){$("#mask").off("click",$.proxy(this.hide,this)),this.stopListening()},show:function(e){$("#mask").show(),$("#mask").on("click",$.proxy(this.hide,this)),this.$(".dropDown").addClass("opened"),this.$(".down").removeClass("icon-angle-down").addClass("icon-angle-up"),e.stopImmediatePropagation()},hide:function(e){$("#mask").hide(),$("#mask").off("click",$.proxy(this.hide,this)),this.$(".dropDown").removeClass("opened"),this.$(".down").removeClass("icon-angle-up").addClass("icon-angle-down"),e.stopImmediatePropagation()}}),Wu.Views.toastMaster=Backbone.View.extend({initialize:function(){this.listenTo(Wu.Cache.Collections.renderers,"add",function(e){this.message('New media renderer "'+e.get("name")+'" detected')},this),this.listenTo(Wu.Cache.Collections.renderers,"remove",function(e){this.message('Media renderer "'+e.get("name")+'" removed')},this),this.listenTo(Wu.Cache.Collections.servers,"add",function(e){this.message('New media server "'+e.get("name")+'" detected')},this),this.listenTo(Wu.Cache.Collections.servers,"remove",function(e){this.message('Media server "'+e.get("name")+'" removed')},this),this.listenTo(Wu.Cache.Models.player,"change:currentPlayingTrack",function(e,t){t&&this.title(t.Title)},this),this.listenTo(Wu.Cache.Models.player,"change:uuid",function(e,t){var i=Wu.Cache.Collections.renderers.get(t);i?this.message('Now playing to "'+i.get("name")+'" renderer'):this.message("No media renderer selected")},this),Socket.on("error",$.proxy(function(e){this.error(e)},this)),Socket.on("tracksInserted",$.proxy(function(){this.message("New tracks inserted")},this)),this.messageStack=[]},title:function(e){window.clearTimeout(this.titleTimeout),$("title").html(e),this.titleTimeout=window.setTimeout(function(){$("title").html("Wu")},4e3)},message:function(e){this.messageStack.push({text:e,type:"message"}),this._show()},error:function(e){this.messageStack.push({text:e,type:"error"}),this._show()},_add:function(e){this.messageStack.push(e),$(".toast").html(e),$(".toast-wrap").show(),window.setTimeout(function(){$(".toast-wrap").hide()},4e3)},_show:function(){if("none"===$(".toast-wrap").css("display")&&this.messageStack.length){var e=this.messageStack.shift();$(".toast-wrap")["error"===e.type?"addClass":"removeClass"]("error").show(),$(".toast").html(e.text),window.setTimeout($.proxy(function(){$(".toast-wrap").hide(),this._show()},this),4e3)}}}),Wu.Views.trackList=Backbone.View.extend({template:JST["track.list"],events:{"click .track-info":"play"},initialize:function(){this.listenTo(Wu.Cache.Models.player,"change:currentPlayingTrack",this.highlight),this.listenTo(this,"inserted",this.highlight),this.listenTo(this,"swipeAway",this.delete),Wu.Mixin.mix(this,Wu.Mixin.swipeAway)},render:function(){var e=this;return this.template({collection:this.collection},function(t,i){e.$el.html(i),e.$("li").length&&e.$("li")[0].scrollIntoView()}),this},unrender:function(){this.stopListening()},highlight:function(){var e=Wu.Cache.Models.player.get("currentPlayingTrack"),t=e?e._id:!1;this.$("li").removeClass("active"),$("#"+t).addClass("active")},play:function(e){if(!$(e.currentTarget).parent().hasClass("transition")){var t=$(e.currentTarget).parent().parent().attr("position");Wu.Cache.Models.player.playByPosition(t,this.model.get("_id"))}},"delete":function(e){var t=this.collection.get(e);t&&t.destroy({error:function(e,t){var i=t.responseText;Wu.Cache.Views.toastMaster.error(i)}})}}),Wu.Models.category=Backbone.Model.extend({ORDER:["Artist","Album","Title"],urlRoot:"/api/categories",initialize:function(){Socket.on("tracksInserted",function(){Wu.Layout.page.trigger("tracksInserted")})},fetch:function(e){var t=this.get("filter");e=e||{},e.data=_.extend({},e.data,{filter:t}),Backbone.Model.prototype.fetch.call(this,e)},filter:function(e,t){var i=this.get("filter")||{},s=this.get("id"),n=_.indexOf(this.ORDER,s);return n++,this.ORDER.length>n?(i[s]=e,this.set("filter",i)):"Title"===s&&(i._id=t),this.ORDER[n]},setCategory:function(e){var t=this.get("filter")||{},i=this.get("id"),s=_.indexOf(this.ORDER,i);for(newIndex=_.indexOf(this.ORDER,e);s>=newIndex;)t[this.ORDER[s]]&&delete t[this.ORDER[s]],s--;t._id&&delete t._id,this.set("filter",t),this.set("id",e)},getTitle:function(){for(var e=this.get("filter")||{},t=this.get("id"),i=_.indexOf(this.ORDER,t);--i>=0;)if(e[this.ORDER[i]])return e[this.ORDER[i]];return!1}}),Wu.Models.directory=Backbone.Model.extend({urlRoot:function(){return"/api/directory/"+this.get("uuid")+"/"},initialize:function(){this.titleMap={}},filter:function(e,t){return t?(this.titleMap[t]=e,this.get("uuid")+"/"+t):!1},getTitle:function(){return this.titleMap[this.get("id")]}}),Wu.Models.player=Backbone.Model.extend({urlRoot:"/api/renderers",idAttribute:"uuid",initialize:function(){var e=this;Socket.on("stateChange",function(t){e.set(t.name,t.value)}),Socket.on("setRendererResult",function(t,i){t?(Wu.Cache.Views.toastMaster.error(t),e.clear()):(e.set("uuid",i),e.fetch())}),Socket.on("rendererRemoved",function(t){e.get("uuid")===t.uuid&&e.clear()})},playByPosition:function(e,t){Socket.emit("playByPosition",e,t)},setRenderer:function(e){Socket.emit("setRenderer",e)}}),Wu.Models.playlist=Backbone.Model.extend({urlRoot:"/api/playlists",idAttribute:"_id"}),Wu.Models.renderer=Backbone.Model.extend({idAttribute:"uuid",urlRoot:"/api/renderers"}),Wu.Models.server=Backbone.Model.extend({idAttribute:"uuid",urlRoot:"/api/servers"}),Wu.Models.tracks=Backbone.Model.extend({idAttribute:"position"}),Wu.Collections.playlists=Backbone.Collection.extend({initialize:function(){Socket.on("rendererAdded",$.proxy(function(){this.fetch()},this))},model:Wu.Models.playlist,url:"/api/playlists"}),Wu.Collections.renderers=Backbone.Collection.extend({model:Wu.Models.renderer,url:"/api/renderers",initialize:function(){var e=this;Socket.on("rendererAdded",function(t){e.add(t)}),Socket.on("rendererRemoved",function(t){e.remove(e.get(t.uuid))})}}),Wu.Collections.servers=Backbone.Collection.extend({model:Wu.Models.server,url:"/api/servers",setTracks:function(e){this.tracksInserted!=e&&(this.tracksInserted=e,this.trigger("change:tracksInserted"))},initialize:function(){var e=this;Socket.on("serverAdded",function(t){"inserted"===t.status&&e.setTracks(!0),e.add(t)}),Socket.on("serverRemoved",function(t){e.remove(this.get(t.uuid))}),this.on("reset",function(){e.each(function(t){"inserted"===t.get("status")&&e.setTracks(!0)})}),Socket.on("tracksInserted",function(t){console.log("tracksInserted",t);var i=e.get(t);i&&i.set("status","inserted"),e.setTracks(!0)}),this.hasTracks=!1}}),Wu.Collections.tracks=Backbone.Collection.extend({model:Wu.Models.tracks,initialize:function(e){this._id=e.id},url:function(){return"/api/playlists/"+this._id}}),Wu.Routers.Categories=Backbone.Router.extend({routes:{"":"index","category/:id":"show","playlist/:id":"showList","directory/:uuid/:id":"showDir"},index:function(){this.show("Artist")},show:function(e){var t=Wu.Cache.Models.category;if(t.setCategory(e),"categories"!=Wu.Layout.state){var i=new Wu.Views.categoriesNav({model:t}),s=new Wu.Views.categories({model:t});Wu.Layout.menu.trigger("hideMusic"),t.fetch({success:function(){Wu.Layout.setSubHeader(i),Wu.Layout.setPage(s),Wu.Layout.state="categories"},error:function(){Wu.Cache.Views.toastMaster.error("failed to get category")}})}},showList:function(e){var t,i=Wu.Cache.Collections.playlists.get(e);i?(t=i.get("tracks")||i.set("tracks",new Wu.Collections.tracks({id:e})).get("tracks"),Wu.Layout.state="playlist",Wu.Layout.menu.trigger("showMusic"),t.fetch({success:function(){var e=new Wu.Views.playlistDropdown({model:i}),s=new Wu.Views.trackList({model:i,collection:t,className:"category"});Wu.Layout.setSubHeader(e),Wu.Layout.setPage(s)},error:function(e,t){Wu.Cache.Views.toastMaster.error(t.responseText)}})):Wu.Cache.Views.toastMaster.error("Playlist not found")},showDir:function(e,t){var i=Wu.Cache.Models.directory.get("uuid");if("directory"!=Wu.Layout.state){var s=new Wu.Views.directoryMenu({model:Wu.Cache.Models.directory}),n=new Wu.Views.directories({model:Wu.Cache.Models.directory});Wu.Layout.setSubHeader(s),Wu.Layout.setPage(n),Wu.Layout.state="directory"}Wu.Layout.menu.trigger("showMusic"),Wu.Cache.Models.directory.set("uuid",e),i!=e?(Wu.Cache.Models.directory.set({id:t},{silent:!0}),Wu.Cache.Models.directory.trigger("change:id")):Wu.Cache.Models.directory.set({id:t})}}),function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;t.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),s=Math.max(0,16-(i-e)),n=window.setTimeout(function(){t(i+s)},s);return e=i+s,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Wu.Mixin={mix:function(e,t){for(var i,s="_mixin",n=0,o=[];e[s+n];)n++;t.mixID=s+n,e[s]=t,t.view=e,i=_.isFunction(t.events)?t.events():t.events||{},_.each(i,function(i,s){if(!_.isFunction(t[i]))return console.log(i+" is not a function"),void 0;var n=s.split(/\b/);e.$el.on(n[0],n.slice(1).join(""),$.proxy(t[i],t))}),_.extend(e.events,{},o)}},Wu.Mixin.swipeAway={touchable:"ontouchstart"in document.documentElement,events:function(){return map={},map=this.touchable?{"touchstart .swipeEl":"start","touchmove  .swipeEl":"move","touchend   .swipeEl":"end"}:{"mousedown .swipeEl":"start","mousemove .swipeEl":"move","mouseout  .swipeEl":"end","mouseup   .swipeEl":"end"},map["webkitTransitionEnd .swipeEl"]="transitionEnd",map["transitionend .swipeEl"]="transitionEnd",map["click .swipeEl h1"]="undo",map},position:function(e){return e.touches?e.touches[0].pageX:e.pageX},start:function(e){this.cover=$(e.currentTarget).find(".swipeCover"),$(e.currentTarget).hasClass("transition")||(this.active=!0,this.startX=this.position(e),this.pos=0,this.touchable||e.preventDefault())},move:function(e){if(this.active){var t=this.position(e);this.pos=Math.min(0,t-this.startX),(-5>this.pos||this.started)&&(this.cover.css("-webkit-transform","translate3d("+this.pos+"px,0,0)"),this.started=!0)}},end:function(){this.active&&this.started&&(-40>this.pos?(this.cover.parent().addClass("transition"),this.cover.css("-webkit-transform","translate3d(-"+this.cover.width()+"px,0,0)")):0>this.pos&&(this.cover.parent().addClass("transition"),this.cover.css("-webkit-transform","translate3d(0,0,0)"))),this.active=!1,this.started=!1},transitionEnd:function(e){-1!=e.propertyName.indexOf("transform")?"translate3d(0px, 0px, 0px)"===$(e.target).css(e.propertyName)?$(e.currentTarget).removeClass("transition"):$(e.currentTarget).css("opacity",0):"opacity"==e.propertyName&&($(e.currentTarget).parent().hide(),this.view.trigger("swipeAway",$(e.currentTarget).parent().attr("id")))},undo:function(e){e.preventDefault(),$(e.currentTarget).parent().css("-webkit-transform","translate3d(0,0,0)").parent().removeClass("transition").css("opacity",1)}};